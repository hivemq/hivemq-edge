# Phase 1 & 2 Complete: Visual Summary

**Task:** 37937-datahub-resource-edit-flow  
**Date:** November 27, 2025  
**Status:** 60% Complete (9/15 subtasks)

---

## ğŸ¯ What We Built

### Phase 1: Resource Management UI (Main DataHub Page)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             DataHub Main Page - Schemas Tab             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Schema Table                                     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Name     â”‚ Type    â”‚ Version â”‚ Actions          â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ sensor   â”‚ JSON    â”‚ 1       â”‚ [âš™] [â†“] [ğŸ—‘]     â”‚   â”‚
â”‚  â”‚ sensor   â”‚ JSON    â”‚ 2       â”‚ [âš™] [â†“] [ğŸ—‘]     â”‚   â”‚
â”‚  â”‚ device   â”‚ Protobufâ”‚ 1       â”‚ [âš™] [â†“] [ğŸ—‘]     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚ Actions: [Create New Schema]                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â†“ Click "Create" or [âš™]                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SchemaEditor Drawer                             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Name: [sensor_data________]                     â”‚   â”‚
â”‚  â”‚ Type: [JSON â–¼]                                  â”‚   â”‚
â”‚  â”‚ Version: DRAFT                                  â”‚   â”‚
â”‚  â”‚ Schema Definition:                              â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚ â”‚ {                                         â”‚   â”‚   â”‚
â”‚  â”‚ â”‚   "type": "object",                       â”‚   â”‚   â”‚
â”‚  â”‚ â”‚   "properties": {                         â”‚   â”‚   â”‚
â”‚  â”‚ â”‚     "temperature": { "type": "number" }   â”‚   â”‚   â”‚
â”‚  â”‚ â”‚   }                                       â”‚   â”‚   â”‚
â”‚  â”‚ â”‚ }                                         â”‚   â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                        [Cancel] [Save]          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Features:**

- âœ… Create new schemas from table
- âœ… Edit existing schemas (creates new version)
- âœ… JSON syntax validation
- âœ… Protobuf syntax validation
- âœ… Duplicate name prevention
- âœ… Dirty state tracking

---

### Phase 2: Simplified Node Configuration (Policy Designer)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Policy Designer Canvas                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚   [Topic Filter] â”€â”€â†’ [Schema] â”€â”€â†’ [Validator]          â”‚
â”‚                         â”‚                               â”‚
â”‚                         â”‚ User clicks node              â”‚
â”‚                         â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SchemaPanelSimplified (Side Panel)              â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Name: [sensor â–¼]                                â”‚   â”‚
â”‚  â”‚       â”œâ”€ sensor                                 â”‚   â”‚
â”‚  â”‚       â”œâ”€ device                                 â”‚   â”‚
â”‚  â”‚       â””â”€ message                                â”‚   â”‚
â”‚  â”‚                                                 â”‚   â”‚
â”‚  â”‚ Version: [2 â–¼]                                  â”‚   â”‚
â”‚  â”‚          â”œâ”€ 1                                   â”‚   â”‚
â”‚  â”‚          â””â”€ 2 (latest)                          â”‚   â”‚
â”‚  â”‚                                                 â”‚   â”‚
â”‚  â”‚ Type: JSON (readonly)                           â”‚   â”‚
â”‚  â”‚                                                 â”‚   â”‚
â”‚  â”‚ Schema Definition: (readonly preview)           â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚ â”‚ {                                         â”‚   â”‚   â”‚
â”‚  â”‚ â”‚   "type": "object",                       â”‚   â”‚   â”‚
â”‚  â”‚ â”‚   "properties": {                         â”‚   â”‚   â”‚
â”‚  â”‚ â”‚     "temperature": { "type": "number" }   â”‚   â”‚   â”‚
â”‚  â”‚ â”‚   }                                       â”‚   â”‚   â”‚
â”‚  â”‚ â”‚ }                                         â”‚   â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                   [Apply]       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Features:**

- âœ… Select existing schema by name (dropdown)
- âœ… Select version for chosen schema
- âœ… Readonly preview of schema content (syntax highlighted)
- âœ… NO creation (must create from main page)
- âœ… NO editing (must edit from main page)
- âœ… Simple, focused UI

---

## ğŸ”„ User Flow Comparison

### âŒ OLD FLOW (Confusing)

```
1. Open policy designer
   â†“
2. Add schema node
   â†“
3. Node panel opens
   â†“
4. CONFUSED: Am I creating a schema or configuring a node?
   â†“
5. Mix of "Create new" vs "Select existing"
   â†“
6. Complex form with draft versions, type switching
   â†“
7. Save â†’ schema created AND node configured
```

**Problems:**

- Mixed concerns (schema CRUD + node config)
- Unclear mental model
- Complex state management
- 200+ LOC panels

---

### âœ… NEW FLOW (Clear)

```
STEP 1: Resource Management (DataHub Main Page)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Go to DataHub â†’ Schemas tab
   â†“
2. Click "Create New Schema"
   â†“
3. Fill schema details (name, type, definition)
   â†“
4. Save â†’ schema created (version 1)
   â†“
5. Later: Edit schema â†’ creates version 2
   â†“
Schema library built âœ…


STEP 2: Policy Design (Designer Canvas)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Open policy designer
   â†“
2. Add schema node
   â†“
3. Node panel opens (SchemaPanelSimplified)
   â†“
4. Select schema name from dropdown
   â†“
5. Select version (or keep latest)
   â†“
6. Preview schema content (readonly)
   â†“
7. Apply â†’ node configured âœ…
```

**Benefits:**

- Clear separation: resource management vs resource selection
- Simple mental model
- Focused UI components
- ~150 LOC panels (25% reduction)

---

## ğŸ“Š Code Changes Summary

### Phase 1 Files (5 created, 5 modified)

**Created:**

1. `SchemaEditor.tsx` (225 LOC)
2. `SchemaEditor.spec.cy.tsx` (21 tests)
3. `ScriptEditor.tsx` (195 LOC)
4. `ScriptEditor.spec.cy.tsx` (19 tests)
5. Design docs

**Modified:**

1. `SchemaTable.tsx` (+50 LOC, +3 tests)
2. `ScriptTable.tsx` (+50 LOC, +3 tests)
3. `DataHubListAction.tsx` (+10 LOC, +1 test)
4. Test files (+80 LOC tests)
5. i18n (+25 keys)

**Total Phase 1:** ~420 LOC new code, 26 active tests passing

---

### Phase 2 Files (4 created, 5 modified)

**Created:**

1. `SchemaPanelSimplified.tsx` (150 LOC)
2. `SchemaPanelSimplified.spec.cy.tsx` (14 tests)
3. `FunctionPanelSimplified.tsx` (140 LOC)
4. `FunctionPanelSimplified.spec.cy.tsx` (14 tests)

**Modified:**

1. `ResourceNameCreatableSelect.tsx` (+40 LOC, +4 tests)
2. `ResourceNameCreatableSelect.spec.cy.tsx` (+80 LOC)
3. `datahubRJSFWidgets.tsx` (+3 LOC)
4. `editors.config.tsx` (~5 LOC changed) â† **THE WIRING!**
5. i18n (+10 keys)

**Total Phase 2:** ~370 LOC new code, 2 active tests passing

---

## ğŸ‰ Key Achievements

### 1. Separation of Concerns âœ…

```
Before: SchemaPanel (200 LOC)
â”œâ”€ Resource CRUD
â”œâ”€ Node configuration
â”œâ”€ Complex state management
â””â”€ Programmatic update refs

After: Two focused components
â”œâ”€ SchemaEditor (225 LOC) - Full CRUD on main page
â””â”€ SchemaPanelSimplified (150 LOC) - Selection only in designer
```

### 2. Improved UX âœ…

- **Clear context**: Users know where they are (managing resources vs designing policy)
- **Focused actions**: Each screen has one purpose
- **Predictable behavior**: No surprising side effects

### 3. Maintainable Code âœ…

- **No programmatic update refs**: Removed complex cascade prevention
- **No mode switching**: Separate components for create vs select
- **Simple validation**: Focused on specific task
- **Easy to test**: Each component has single responsibility

### 4. Configuration-Based Architecture âœ…

```typescript
// editors.config.tsx - Single point of control
export const DefaultEditor = {
  [DataHubNodeType.SCHEMA]: SchemaPanelSimplified, // â† Just change this!
  [DataHubNodeType.FUNCTION]: FunctionPanelSimplified,
  // ... other node types
}
```

**Benefit:** Could add feature flag here to toggle old/new panels if needed!

---

## ğŸ“ˆ Progress

```
âœ… Phase 1: Resource Editor Infrastructure    [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%
âœ… Phase 2: Simplified Node Configuration     [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%
â¬œ Phase 3: Publishing Flow Updates           [Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·]   0%
â¬œ Phase 4: Testing & Documentation           [Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·]   0%

Overall: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆÂ·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·] 60% (9/15 subtasks)
```

---

## ğŸš€ Next: Phase 3

### Publishing Flow Updates (3 subtasks, 3 days)

**Goal:** Ensure publishing works with new architecture

**Tasks:**

1. Verify resource references in policy payloads
2. Update dry-run validation (resources must exist)
3. Update PolicySummaryReport (show referenced resources)

**Investigation Needed:**

- How are schemas referenced in `DataPolicyValidator.arguments`?
- Does current ToolbarPublish already separate resource publishing?
- What needs to change (if anything)?

---

**Status:** âœ… Phases 1 & 2 Complete  
**Next:** Investigate API contracts before Phase 3  
**Last Updated:** November 27, 2025
er
