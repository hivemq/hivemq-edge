# Analysis Complete

**Date:** 2026-02-17
**Output document:** `docs/analysis/PROBLEM_DETAIL_ANALYSIS.md`

## Summary of Findings

### Backend Status

PR #993 has implemented RFC 9457 for DataHub. New payloads have proper URI `type` fields, meaningful `detail` strings, and structured `errors[]` sub-causes with `path`, `condition`, `dependencies`, `value`, and `remedial` fields.

### Frontend Gaps (4 categories)

1. **Type safety** — `ApiError.body: any` is cast everywhere; no TypeScript narrowing on error `type` URI
2. **Non-RFC field access** — `useEdgeToast` reads `body.message` and `body.errors[].fieldName` (neither exists in RFC 9457)
3. **Dev-only toast** — `ApiErrorToastDevMode` is explicitly `@todo DO NOT USE IN PRODUCTION`
4. **Untapped discriminated unions** — `__generated_v2__` has 14+ typed error shapes that could drive node highlighting and form navigation in DataHub

### The New Client Opportunity

`src/api/__generated_v2__/` (generated by `@hey-api/openapi-ts`) provides complete discriminated union types per operation. Example: `CreateBehaviorPolicyError` = union of `BehaviorPolicyCreationFailureError | BehaviorPolicyInvalidErrors | BehaviorPolicyRejectedError | ...` etc. — all with literal `type` URI strings TypeScript can narrow on.

### Migration Scope

- **Phase 1** — 1 file, no consumer changes: update custom `ProblemDetails` type
- **Phase 2** — 1 new util + ~6 hook updates: normalizer that handles both old and new clients
- **Phase 3** — 1 new component + 3 file updates: production `ProblemDetailToast` replacing dev-only component
- **Phase 4** — 1 new util + ~8 DataHub files: rich error navigation with path-to-node mapping (requires new client migration for DataHub mutations)

Total: ~3 new files, ~18 modified files, ~25 new tests.
