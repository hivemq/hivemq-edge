name: CI Check

on:
  push:

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  changed:
    runs-on: ubuntu-latest
    outputs:
      frontend-changed: ${{ steps.frontend.outputs.changed }}
      backend-changed: ${{ steps.backend.outputs.changed }}
    steps:
      - name: Checkout
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4
        with:
          fetch-depth: 0
          
      - name: Check for backend changes
        uses: dorny/paths-filter@de90cc6fb38fc0963ad72b210f1f284cd68cea36 # v3.0.1
        id: backend
        with:
          filters: |
            changed:
              - 'hivemq-edge/**'
              - 'edge-plugins/**'
              - 'docker/**'
              - 'modules/**'

      - name: Check for frontend changes
        uses: dorny/paths-filter@de90cc6fb38fc0963ad72b210f1f284cd68cea36 # v3.0.1
        id: frontend
        with:
          filters: |
            changed:
              - 'hivemq-edge-frontend/**'

  check-frontend:
    needs: changed
    uses: ./.github/workflows/check-frontend.yml
    if: needs.changed.outputs.frontend-changed == 'true'

  check-backend:
    needs: changed
    uses: ./.github/workflows/check-backend.yml
    if: needs.changed.outputs.backend-changed == 'true'
