<?xml version="1.0"?>
<!--
  ~ Copyright 2025-present HiveMQ GmbH
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<hivemq xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="config.xsd">

    <!--
        Example: Admin API with LDAP Authentication (Legacy Mode)

        This configuration demonstrates LEGACY MODE - backward compatible with
        existing configurations that don't use the base-dn element.

        In legacy mode (no base-dn specified):
        - rdns is treated as an ABSOLUTE distinguished name
        - Service account rdns is RELATIVE to the base rdns
        - Service account DN = service rdns + base rdns

        This is the behavior before the base-dn feature was introduced.
    -->

    <admin-api>
        <enabled>true</enabled>

        <ldap>
            <ldap-authentication>
                <!-- LDAP Servers Configuration -->
                <servers>
                    <ldap-server>
                        <host>ldap.example.com</host>
                        <port>636</port>
                    </ldap-server>
                </servers>

                <tls-mode>LDAPS</tls-mode>

                <tls>
                    <truststore-path>/path/to/truststore.jks</truststore-path>
                    <truststore-password>changeit</truststore-password>
                    <truststore-type>JKS</truststore-type>
                </tls>

                <max-connections>5</max-connections>

                <uid-attribute>uid</uid-attribute>

                <!--
                    LEGACY MODE: rdns is ABSOLUTE DN
                    User DNs will be: uid={username},ou=people,dc=example,dc=com
                -->
                <rdns>ou=people,dc=example,dc=com</rdns>

                <!--
                    NO base-dn element = LEGACY MODE
                    If you want to migrate to the new mode, add:
                    <base-dn>dc=example,dc=com</base-dn>
                    and change rdns to: <rdns>ou=people</rdns>
                -->

                <required-object-class>inetOrgPerson</required-object-class>

                <!--
                    Service Account Configuration (LEGACY MODE)
                    Service account rdns is RELATIVE to the base rdns above.

                    Service account DN will be:
                    cn=admin + ou=people,dc=example,dc=com
                    = cn=admin,ou=people,dc=example,dc=com

                    Note: In legacy mode, service account MUST be in the same OU
                    as the user search base (ou=people).
                -->
                <simple-bind>
                    <rdns>cn=admin</rdns>
                    <user-password>admin-password</user-password>
                </simple-bind>

                <!--
                    Migration to New Mode:

                    To enable the new mode (service account in different OU):
                    1. Add: <base-dn>dc=example,dc=com</base-dn>
                    2. Change rdns to: <rdns>ou=people</rdns>
                    3. Change service account to: <rdns>cn=admin,ou=system</rdns>

                    This allows the service account to be in ou=system while
                    users are in ou=people.
                -->
            </ldap-authentication>
        </ldap>
    </admin-api>

</hivemq>
