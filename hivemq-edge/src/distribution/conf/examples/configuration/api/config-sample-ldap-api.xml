<?xml version="1.0"?>
<!--
  ~ Copyright 2025-present HiveMQ GmbH
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<hivemq xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="config.xsd">

    <!--
        Example: Admin API with LDAP Authentication

        This configuration enables LDAP-based authentication for the Admin API.
        Instead of managing users in the config file, users are authenticated
        against an LDAP directory server.

        Supported TLS modes:
        - NONE: Plain LDAP (port 389, not recommended for production)
        - LDAPS: LDAP over TLS from connection start (port 636, recommended)
        - START_TLS: Plain connection upgraded to TLS (port 389)
    -->

    <admin-api>
        <enabled>true</enabled>

        <!-- LDAP Authentication Configuration -->
        <ldap>
            <ldap-authentication>
                <!-- LDAP Server Configuration -->
                <host>ldap.example.com</host>
                <port>636</port>  <!-- 636 for LDAPS, 389 for plain LDAP or START_TLS -->
                <tls-mode>LDAPS</tls-mode>  <!-- Options: NONE, LDAPS, START_TLS -->

                <!-- TLS/SSL Configuration (required for LDAPS and START_TLS) -->
                <tls>
                    <!-- Path to truststore containing CA certificates -->
                    <truststore-path>/path/to/truststore.jks</truststore-path>
                    <truststore-password>changeit</truststore-password>
                    <truststore-type>JKS</truststore-type>  <!-- JKS or PKCS12 -->
                </tls>

                <!-- Optional: Connection Timeouts (in milliseconds) -->
                <connect-timeout-millis>5000</connect-timeout-millis>    <!-- 5 seconds -->
                <response-timeout-millis>10000</response-timeout-millis>  <!-- 10 seconds -->

                <!-- Optional: Maximum number of connections in the pool -->
                <max-connections>5</max-connections>

                <!--
                    User Identifier Attribute
                    The LDAP attribute used to identify users (default: uid)
                    Common values: uid, cn, sAMAccountName (Active Directory)
                -->
                <uid-attribute>uid</uid-attribute>

                <!--
                    Relative Distinguished Names (RDNs)
                    - NEW MODE (with base-dn below): Specify relative path (e.g., "ou=people")
                    - LEGACY MODE (without base-dn): Specify absolute DN (e.g., "ou=people,dc=example,dc=com")

                    This is combined with uid-attribute to form user DNs:
                    - User DN will be: uid={username},ou=people,dc=example,dc=com
                -->
                <rdns>ou=people</rdns>

                <!--
                    Base DN (Optional)
                    The root of your LDAP directory tree.

                    NEW MODE: When specified, both rdns and service account rdns are relative to this.
                    This allows service accounts in different OUs than users:
                    - User search base: rdns + base-dn = "ou=people,dc=example,dc=com"
                    - Service account: service rdns + base-dn = "cn=admin,ou=system,dc=example,dc=com"

                    LEGACY MODE: If omitted, rdns is treated as absolute DN.
                -->
                <base-dn>dc=example,dc=com</base-dn>

                <!--
                    Optional: Object class filter for user entries
                    Only entries with this object class will be considered valid users
                -->
                <required-object-class>inetOrgPerson</required-object-class>

                <!--
                    Directory Descent Mode (Optional)
                    - false (default): Direct binding - faster, uses uid-attribute and rdns
                    - true: Search mode - searches for user in directory tree, more flexible
                -->
                <directory-descent>false</directory-descent>

                <!-- Optional: Search timeout for directory descent mode (in seconds) -->
                <search-timeout-seconds>5</search-timeout-seconds>

                <!--
                    Service Account Configuration
                    The LDAP account used to bind to the server for user lookups.

                    NEW MODE (with base-dn): rdns is relative to base-dn
                    - Example: cn=admin,ou=system + dc=example,dc=com = cn=admin,ou=system,dc=example,dc=com

                    LEGACY MODE (without base-dn): rdns is relative to the base rdns above
                    - Example: cn=admin + ou=people,dc=example,dc=com = cn=admin,ou=people,dc=example,dc=com
                -->
                <simple-bind>
                    <rdns>cn=admin,ou=system</rdns>
                    <user-password>admin-password</user-password>
                </simple-bind>
            </ldap-authentication>
        </ldap>
    </admin-api>

</hivemq>
