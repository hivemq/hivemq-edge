<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<hivemq>
    <mqtt-listeners>
        <tcp-listener>
            <port>1883</port>
            <bind-address>0.0.0.0</bind-address>
            <external-hostname>localhost</external-hostname>
        </tcp-listener>
    </mqtt-listeners>
    <mqtt-sn-listeners>
        <udp-listener>
            <port>2442</port>
            <bind-address>0.0.0.0</bind-address>
            <external-hostname>localhost</external-hostname>
        </udp-listener>
    </mqtt-sn-listeners>
    <dynamic-configuration>
        <allow-configuration-export>true</allow-configuration-export>
        <allow-mutable-configuration>true</allow-mutable-configuration>
    </dynamic-configuration>
    <usage-tracking>
        <enabled>true</enabled>
    </usage-tracking>
    <mqtt>
        <queued-messages>
            <max-queue-size>1000</max-queue-size>
            <strategy>discard</strategy>
        </queued-messages>
        <retained-messages>
            <enabled>true</enabled>
        </retained-messages>
        <wildcard-subscriptions>
            <enabled>true</enabled>
        </wildcard-subscriptions>
        <quality-of-service>
            <max-qos>2</max-qos>
        </quality-of-service>
        <topic-alias>
            <enabled>true</enabled>
            <max-per-client>5</max-per-client>
        </topic-alias>
        <message-expiry>
            <max-interval>4294967296</max-interval>
        </message-expiry>
        <session-expiry>
            <max-interval>4294967295</max-interval>
        </session-expiry>
        <subscription-identifier>
            <enabled>true</enabled>
        </subscription-identifier>
        <shared-subscriptions>
            <enabled>true</enabled>
        </shared-subscriptions>
        <keep-alive>
            <max-keep-alive>65535</max-keep-alive>
            <allow-unlimited>true</allow-unlimited>
        </keep-alive>
        <packets>
            <max-packet-size>268435460</max-packet-size>
        </packets>
        <receive-maximum>
            <server-receive-maximum>10</server-receive-maximum>
        </receive-maximum>
    </mqtt>
    <mqtt-sn>
        <predefined-topics>
            <predefined-topic>
                <topicName>my/predefined/example/topic/1</topicName>
                <alias>1</alias>
            </predefined-topic>
        </predefined-topics>
        <allow-empty-client-identifier>
            <enabled>false</enabled>
        </allow-empty-client-identifier>
        <discovery>
            <enabled>true</enabled>
            <broadcast-addresses>
                <address>
                    <port>2442</port>
                    <bind-address>255.255.255.0</bind-address>
                </address>
            </broadcast-addresses>
            <discovery-interval-seconds>5</discovery-interval-seconds>
        </discovery>
        <allow-anonymous-publish-minus-one>
            <enabled>false</enabled>
        </allow-anonymous-publish-minus-one>
        <allow-waking-ping-session-hijack>
            <enabled>false</enabled>
        </allow-waking-ping-session-hijack>
        <topic-registrations-held-during-sleep>
            <enabled>false</enabled>
        </topic-registrations-held-during-sleep>
        <max-client-identifier-length>23</max-client-identifier-length>
        <gateway-id>1</gateway-id>
    </mqtt-sn>
    <restrictions>
        <max-connections>-1</max-connections>
        <max-client-id-length>65535</max-client-id-length>
        <max-topic-length>65535</max-topic-length>
        <no-connect-idle-timeout>10000</no-connect-idle-timeout>
        <incoming-bandwidth-throttling>0</incoming-bandwidth-throttling>
    </restrictions>
    <security>
        <payload-format-validation>
            <enabled>false</enabled>
        </payload-format-validation>
        <utf8-validation>
            <enabled>true</enabled>
        </utf8-validation>
        <allow-empty-client-id>
            <enabled>true</enabled>
        </allow-empty-client-id>
        <allow-request-problem-information>
            <enabled>true</enabled>
        </allow-request-problem-information>
    </security>
    <persistence>
        <mode>in-memory</mode>
    </persistence>
    <mqtt-bridges>
        <mqtt-bridge>
            <id>simons-bridge-there</id>
            <remote-broker>
                <port>8883</port>
                <host>some-host</host>
                <mqtt>
                    <clean-start>false</clean-start>
                    <session-expiry>3600</session-expiry>
                    <keep-alive>60</keep-alive>
                </mqtt>
                <authentication>
                    <mqtt-simple-authentication>
                        <username>hivemq-edge</username>
                        <password>some-password</password>
                    </mqtt-simple-authentication>
                </authentication>
                <tls>
                    <enabled>true</enabled>
                    <protocols/>
                    <cipher-suites/>
                    <handshake-timeout>10</handshake-timeout>
                    <verify-hostname>true</verify-hostname>
                </tls>
            </remote-broker>
            <remote-subscriptions>
                <remote-subscription>
                    <filters>
                        <mqtt-topic-filter>remote/subscription</mqtt-topic-filter>
                    </filters>
                    <max-qos>0</max-qos>
                    <preserve-retain>false</preserve-retain>
                    <custom-user-properties/>
                </remote-subscription>
            </remote-subscriptions>
            <forwarded-topics>
                <forwarded-topic>
                    <filters>
                        <mqtt-topic-filter>#</mqtt-topic-filter>
                    </filters>
                    <max-qos>0</max-qos>
                    <preserve-retain>true</preserve-retain>
                    <destination>prefix/{#}/bridge/${bridge.name}</destination>
                    <custom-user-properties>
                        <user-property>
                            <key>test1</key>
                            <value>test2</value>
                        </user-property>
                    </custom-user-properties>
                    <excludes/>
                </forwarded-topic>
            </forwarded-topics>
            <loop-prevention>
                <enabled>true</enabled>
                <hop-count-limit>1</hop-count-limit>
            </loop-prevention>
        </mqtt-bridge>
    </mqtt-bridges>
    <admin-api>
        <enabled>true</enabled>
        <listeners/>
        <generated-tokens>
            <keySize>2048</keySize>
            <issuer>HiveMQ-Edge</issuer>
            <audience>HiveMQ-Edge-Api</audience>
            <expiryTimeMinutes>30</expiryTimeMinutes>
            <tokenEarlyEpochThresholdMinutes>2</tokenEarlyEpochThresholdMinutes>
        </generated-tokens>
        <users>
            <user>
                <username>admin</username>
                <password>password</password>
                <roles>
                    <role>admin</role>
                </roles>
            </user>
        </users>
    </admin-api>
    <uns>
        <isa95>
            <enabled>true</enabled>
            <prefix-all-topics>true</prefix-all-topics>
            <enterprise>enterprise</enterprise>
            <site>site</site>
            <area>area</area>
            <production-line>production-line</production-line>
            <work-cell>work-cell</work-cell>
        </isa95>
    </uns>
    <protocol-adapters>
        <opc-ua-adapter>
            <subscriptions>
                <subscription>
                    <mqtt-topic>test/blubb/#</mqtt-topic>
                    <node>ns=1;i=1004</node>
                </subscription>
            </subscriptions>
            <auth>
                <basic>
                    <password>password</password>
                    <username>edge</username>
                </basic>
            </auth>
            <id>simulation-server-2</id>
            <uri>opc.tcp://CSM1.local:53530/OPCUA/SimulationServer</uri>
        </opc-ua-adapter>
        <modbus-adapter>
            <hostName>127.0.0.1</hostName>
            <publishChangedDataOnly>true</publishChangedDataOnly>
            <subscriptions>
                <subscription>
                    <mqtt-topic>test</mqtt-topic>
                    <coils>
                        <endIdx>10000000</endIdx>
                        <startIdx>100000</startIdx>
                    </coils>
                    <registers>
                        <endIdx>10</endIdx>
                        <startIdx>1</startIdx>
                    </registers>
                </subscription>
            </subscriptions>
            <port>5021</port>
            <pollingIntervalMillis>1000</pollingIntervalMillis>
            <id>modbus-1</id>
            <maxPollingErrorsBeforeRemoval>5</maxPollingErrorsBeforeRemoval>
        </modbus-adapter>
        <modbus-adapter>
            <hostName>127.0.0.1</hostName>
            <publishChangedDataOnly>true</publishChangedDataOnly>
            <subscriptions>
                <subscription>
                    <mqtt-topic>test</mqtt-topic>
                    <coils>
                        <endIdx>10000000</endIdx>
                        <startIdx>100000</startIdx>
                    </coils>
                    <registers>
                        <endIdx>10</endIdx>
                        <startIdx>1</startIdx>
                    </registers>
                </subscription>
                <subscription>
                    <mqtt-topic>test</mqtt-topic>
                    <coils>
                        <endIdx>10000000</endIdx>
                        <startIdx>100000</startIdx>
                    </coils>
                    <registers>
                        <endIdx>10</endIdx>
                        <startIdx>1</startIdx>
                    </registers>
                </subscription>
                <subscription>
                    <mqtt-topic>test</mqtt-topic>
                    <coils>
                        <endIdx>10000000</endIdx>
                        <startIdx>100000</startIdx>
                    </coils>
                    <registers>
                        <endIdx>10</endIdx>
                        <startIdx>1</startIdx>
                    </registers>
                </subscription>
            </subscriptions>
            <port>5021</port>
            <pollingIntervalMillis>1000</pollingIntervalMillis>
            <id>modbus-2</id>
            <maxPollingErrorsBeforeRemoval>5</maxPollingErrorsBeforeRemoval>
        </modbus-adapter>
    </protocol-adapters>
    <internal></internal>
</hivemq>
