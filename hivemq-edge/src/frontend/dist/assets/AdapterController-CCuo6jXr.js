import{e as j,aQ as v,aR as O,Q as b,z as B,u as P,i as q,r as C,j as o,D as M,M as w,p as F,aS as Q,q as U,s as _,T as L,v as N,x as V,F as k,B as K,h as z,b as G,a as H}from"./index-cMih3SEP.js";import{u as W}from"./useEdgeToast-ulWoRSS2.js";import{P as I}from"./types-B4vn0nsI.js";import{u as Y}from"./useGetAdapterTypes-Dufd8ZhJ.js";import{u as R}from"./useListProtocolAdapters-B80RXV7q.js";import{c as J}from"./validation-utils-D1Qq58G3.js";import{g as X,C as Z}from"./ChakraRJSForm-BfID56dF.js";import{N as $}from"./NodeNameCard-yfQKWlf9.js";import{N as tt}from"./types-DcJW2o_l.js";import"./toast-utils-BddXXXrS.js";import"./ArrayFieldTemplate-BvbIrrVp.js";import"./without-BTTCd72_.js";import"./index-BXWYaCHO.js";import"./pick-DicWcAKr.js";import"./chunk-TRO7245M-Czmm3RtS.js";import"./chunk-JARCRF6W-CHhnzfpl.js";import"./chunk-ZPFGWTBB-27OtcFRz.js";import"./chunk-W7WUSNWJ-DJm2I2MC.js";import"./index-C23MLgnh.js";import"./chunk-RDF2AYID-BFNDpMsD.js";import"./creatable-select-CDfhMLkq.js";import"./use-chakra-select-props-D5NVA-bJ.js";import"./chunk-KC77MHL3-CpO6TSLY.js";import"./chunk-HB6KBUMZ-BnKuEGjs.js";import"./chunk-OCNORRQU-qVjYAyQ7.js";import"./index-DDmdO6wr.js";import"./select-Cl6Duh2E.js";import"./index-iD7yky8Q.js";import"./config.utils-FEQhkVx6.js";import"./PaginatedTable-CpimMJK6.js";import"./datetime-B2_BsC7v.js";import"./chunk-KO6Q73AP-Bk5HKb-M.js";import"./chunk-VTV6N5LE-DWhDJEfB.js";import"./chunk-RPO2WXNL-BTibYaQa.js";import"./chunk-EL2VKIZQ-C-XtNqj-.js";import"./ArrayFieldItemTemplate-CQ7KDBCe.js";import"./index-UJo6opCj.js";import"./vanilla-Dd4Maacd.js";import"./color-Cs2FUV59.js";import"./EntityTag-D_VD81fJ.js";import"./JsonSchemaBrowser-9_NRMvC_.js";import"./index-C46KiF-i.js";import"./chunk-LZZHVJFG-BAJsNEk_.js";import"./chunk-2EW3JUUD-iAZ0BXIz.js";import"./chunk-FHHZMTWR-BZ2wKB7t.js";import"./index-BTlOwmq4.js";import"./chunk-BDSTZZXD-Biup13z0.js";import"./EntityCreatableSelect-6HDrxMJ3.js";import"./useGetDomainTags-VyBNKn6z.js";import"./useListTopicFilters-BbjQizvN.js";import"./useListBridges-BwHrTuI4.js";import"./topics-utils-l3ij3e8P.js";import"./chunk-IAXSQ4X2-dYM9Hy0E.js";import"./05-icon-industrial-hivemq-edge-CnZ6VqSq.js";import"./adapter.utils-B-ndd-tn.js";import"./chunk-KTD65HY5-BcgUOmvV.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new r.Error().stack;t&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[t]="a4729cea-1b73-4754-9369-a3b7c55fff05",r._sentryDebugIdIdentifier="sentry-dbid-a4729cea-1b73-4754-9369-a3b7c55fff05")}catch{}})();const et=()=>{const r=j(),t=v();return O({mutationFn:({adapterType:n,requestBody:a})=>r.protocolAdapters.addAdapter(n,a),onMutate:n=>{t.setQueryData([b.ADAPTERS,b.CONNECTION_STATUS],a=>{const s={connection:B.connection.DISCONNECTED,id:n.requestBody.id,type:n.requestBody.type};return{items:[...(a==null?void 0:a.items)||[],s]}})},onSuccess:()=>{t.invalidateQueries({queryKey:[b.ADAPTERS]})}})},ot=()=>{const r=j(),t=v();return O({mutationFn:({adapterId:n,requestBody:a})=>r.protocolAdapters.updateAdapter(n,a),onSuccess:()=>{t.invalidateQueries({queryKey:[b.ADAPTERS]})}})},rt=({adapterType:r,isNewAdapter:t=!1,isOpen:e,onClose:n,onSubmit:a})=>{const{t:s}=P(),{data:c}=Y(),{data:l}=R(),{adapterId:m}=q(),{schema:d,uiSchema:g,name:D,logo:y,isDiscoverable:u}=C.useMemo(()=>{var T;const i=(T=c==null?void 0:c.items)==null?void 0:T.find(S=>S.id===r),{configSchema:A,uiSchema:p,capabilities:x}=i||{};return{isDiscoverable:!!(x!=null&&x.includes("DISCOVER")),schema:A,name:i==null?void 0:i.name,logo:i==null?void 0:i.logoUrl,uiSchema:X(p,t)}},[c==null?void 0:c.items,t,r]),f=C.useMemo(()=>{if(t||!m)return;const{config:i}=(l==null?void 0:l.find(A=>A.id===m))||{};return i},[t,m,l]),h=i=>{i.formData&&a(i.formData)},E={isEditAdapter:!t,isDiscoverable:u,adapterType:r,adapterId:m};return o.jsxs(M,{variant:"hivemq",closeOnOverlayClick:!1,size:"lg",isOpen:e,placement:"right",onClose:n,children:[o.jsx(w,{}),o.jsxs(F,{"aria-label":s("protocolAdapter.drawer.label"),children:[!d&&o.jsx(Q,{}),d&&o.jsxs(o.Fragment,{children:[o.jsx(U,{}),o.jsxs(_,{id:"adapter-instance-header",borderBottomWidth:"1px",children:[o.jsx(L,{children:s(t?"protocolAdapter.drawer.title.create":"protocolAdapter.drawer.title.update")}),o.jsx($,{name:D,type:tt.ADAPTER_NODE,icon:y})]}),o.jsx(N,{children:d&&o.jsx(Z,{id:"adapter-instance-form",schema:d,uiSchema:g,formData:f,formContext:E,onSubmit:h,customValidate:J(d,l)})}),o.jsx(V,{borderTopWidth:"1px",children:o.jsx(k,{flexGrow:1,justifyContent:"flex-end",children:o.jsx(K,{variant:"primary",type:"submit",form:"adapter-instance-form",children:s(t?"protocolAdapter.action.create":"protocolAdapter.action.update")})})})]})]})]})},ie=({children:r,isNew:t})=>{const{t:e}=P(),{successToast:n,errorToast:a}=W(),[s,c]=C.useState(void 0),{isOpen:l,onOpen:m,onClose:d}=z(),g=et(),D=ot(),y=G(),{state:u}=H(),{data:f}=R(),{adapterId:h}=q();C.useEffect(()=>{u!=null&&u.protocolAdapterType&&c(u.protocolAdapterType)},[u]),C.useEffect(()=>{if(!f)return;const A=f==null?void 0:f.find(p=>p.id===h);if(!t&&!A){a({id:"adapter-open-noExist",title:e("protocolAdapter.toast.view.title"),description:e("protocolAdapter.toast.view.error")},new Error(e("protocolAdapter.toast.view.noLongerExist",{id:h}))),y("/protocol-adapters",{replace:!0});return}s&&m()},[h,s,f,a,t,y,m,e]);const E=()=>{d(),y("/protocol-adapters",{state:{protocolAdapterTabIndex:I.PROTOCOLS}})},i=A=>{const{id:p,...x}=A;t?g.mutateAsync({adapterType:s,requestBody:{id:p,type:s,config:{...x,id:p}}}).then(()=>{n({title:e("protocolAdapter.toast.create.title"),description:e("protocolAdapter.toast.create.description")})}).catch(S=>a({title:e("protocolAdapter.toast.create.title"),description:e("protocolAdapter.toast.create.error")},S)):D.mutateAsync({adapterId:p,requestBody:{id:p,type:s,config:{...x,id:p}}}).then(()=>{n({title:e("protocolAdapter.toast.update.title"),description:e("protocolAdapter.toast.update.description")})}).catch(S=>a({title:e("protocolAdapter.toast.update.title"),description:e("protocolAdapter.toast.update.error")},S)),d();const T={protocolAdapterTabIndex:I.ADAPTERS,selectedActiveAdapter:{isNew:!!t,isOpen:!1,adapterId:p}};y("/protocol-adapters",{state:T})};return o.jsxs("div",{children:[o.jsx(rt,{adapterType:s,isNewAdapter:t,isOpen:l,isSubmitting:!1,onSubmit:i,onClose:E}),r]})};export{ie as default};
//# sourceMappingURL=AdapterController-CCuo6jXr.js.map
