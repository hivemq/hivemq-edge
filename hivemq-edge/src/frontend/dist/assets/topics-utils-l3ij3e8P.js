import"./index-cMih3SEP.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="fffca2bd-ded2-457c-8d3b-2077a77ec26f",e._sentryDebugIdIdentifier="sentry-dbid-fffca2bd-ded2-457c-8d3b-2077a77ec26f")}catch{}})();function D(e){var t=0,r=e.children,n=r&&r.length;if(!n)t=1;else for(;--n>=0;)t+=r[n].value;e.value=t}function N(){return this.eachAfter(D)}function Q(e,t){let r=-1;for(const n of this)e.call(t,n,++r,this);return this}function q(e,t){for(var r=this,n=[r],o,i,s=-1;r=n.pop();)if(e.call(t,r,++s,this),o=r.children)for(i=o.length-1;i>=0;--i)n.push(o[i]);return this}function F(e,t){for(var r=this,n=[r],o=[],i,s,c,l=-1;r=n.pop();)if(o.push(r),i=r.children)for(s=0,c=i.length;s<c;++s)n.push(i[s]);for(;r=o.pop();)e.call(t,r,++l,this);return this}function K(e,t){let r=-1;for(const n of this)if(e.call(t,n,++r,this))return n}function H(e){return this.eachAfter(function(t){for(var r=+e(t.data)||0,n=t.children,o=n&&n.length;--o>=0;)r+=n[o].value;t.value=r})}function W(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function z(e){for(var t=this,r=G(t,e),n=[t];t!==r;)t=t.parent,n.push(t);for(var o=n.length;e!==r;)n.splice(o,0,e),e=e.parent;return n}function G(e,t){if(e===t)return e;var r=e.ancestors(),n=t.ancestors(),o=null;for(e=r.pop(),t=n.pop();e===t;)o=e,e=r.pop(),t=n.pop();return o}function L(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function R(){return Array.from(this)}function V(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function J(){var e=this,t=[];return e.each(function(r){r!==e&&t.push({source:r.parent,target:r})}),t}function*U(){var e=this,t,r=[e],n,o,i;do for(t=r.reverse(),r=[];e=t.pop();)if(yield e,n=e.children)for(o=0,i=n.length;o<i;++o)r.push(n[o]);while(r.length)}function $(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=Z)):t===void 0&&(t=Y);for(var r=new y(e),n,o=[r],i,s,c,l;n=o.pop();)if((s=t(n.data))&&(l=(s=Array.from(s)).length))for(n.children=s,c=l-1;c>=0;--c)o.push(i=s[c]=new y(s[c])),i.parent=n,i.depth=n.depth+1;return r.eachBefore(C)}function X(){return $(this).eachBefore(ee)}function Y(e){return e.children}function Z(e){return Array.isArray(e)?e[1]:null}function ee(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function C(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function y(e){this.data=e,this.depth=this.height=0,this.parent=null}y.prototype=$.prototype={constructor:y,count:N,each:Q,eachAfter:F,eachBefore:q,find:K,sum:H,sort:W,path:z,ancestors:L,descendants:R,leaves:V,links:J,copy:X,[Symbol.iterator]:U};function I(e){return e==null?null:te(e)}function te(e){if(typeof e!="function")throw new Error;return e}var re={depth:-1},M={},b={};function ne(e){return e.id}function oe(e){return e.parentId}function ie(){var e=ne,t=oe,r;function n(o){var i=Array.from(o),s=e,c=t,l,p,u,f,m,a,d,T,v=new Map;if(r!=null){const h=i.map((g,w)=>se(r(g,w,o))),_=h.map(S),k=new Set(h).add("");for(const g of _)k.has(g)||(k.add(g),h.push(g),_.push(S(g)),i.push(b));s=(g,w)=>h[w],c=(g,w)=>_[w]}for(u=0,l=i.length;u<l;++u)p=i[u],a=i[u]=new y(p),(d=s(p,u,o))!=null&&(d+="")&&(T=a.id=d,v.set(T,v.has(T)?M:a)),(d=c(p,u,o))!=null&&(d+="")&&(a.parent=d);for(u=0;u<l;++u)if(a=i[u],d=a.parent){if(m=v.get(d),!m)throw new Error("missing: "+d);if(m===M)throw new Error("ambiguous: "+d);m.children?m.children.push(a):m.children=[a],a.parent=m}else{if(f)throw new Error("multiple roots");f=a}if(!f)throw new Error("no root");if(r!=null){for(;f.data===b&&f.children.length===1;)f=f.children[0],--l;for(let h=i.length-1;h>=0&&(a=i[h],a.data===b);--h)a.data=null}if(f.parent=re,f.eachBefore(function(h){h.depth=h.parent.depth+1,--l}).eachBefore(C),f.parent=null,l>0)throw new Error("cycle");return f}return n.id=function(o){return arguments.length?(e=I(o),n):e},n.parentId=function(o){return arguments.length?(t=I(o),n):t},n.path=function(o){return arguments.length?(r=I(o),n):r},n}function se(e){e=`${e}`;let t=e.length;return A(e,t-1)&&!A(e,t-2)&&(e=e.slice(0,-1)),e[0]==="/"?e:`/${e}`}function S(e){let t=e.length;if(t<2)return"";for(;--t>1&&!A(e,t););return e.slice(0,t)}function A(e,t){if(e[t]==="/"){let r=0;for(;t>0&&e[--t]==="\\";)++r;if(!(r&1))return!0}return!1}var E=(e=>(e.MQTT_TOPIC="mqtt-topic",e.MQTT_TOPIC_FILTER="mqtt-topic-filter",e.MQTT_TAG="mqtt-tag",e))(E||{});const B="*",j=e=>(e==null?void 0:e.reduce((t,r)=>{const n=r.filters.map(o=>({topic:o}));return t.push(...n),t},[]))||[],ue=e=>({local:j(e.localSubscriptions),remote:j(e.remoteSubscriptions)}),O=(e,t="")=>{let r={};for(const n in e){const o=t?`${t}.${n}`:n;typeof e[n]=="object"&&!Array.isArray(e[n])?r={...r,...O(e[n],o)}:r[o]=e[n]}return r},ce=(e,t=E.MQTT_TOPIC)=>{const r=O(e);return Object.entries(r).filter(([n,o])=>n.endsWith("format")&&o===t).map(([n])=>n.replace(/items\.properties/gi,B).replaceAll("properties.","").replace(".format",""))},ae=(e,t)=>e.split(".").reduce((r,n)=>r==null?void 0:r[n],t),x=(e,t)=>{const[r,...n]=e.split(".");if(!t)return;if(!n.length)return t;if(r===B){const{properties:i}=t.items;return x(n.join("."),i)}const{properties:o}=t;return x(n.join("."),o==null?void 0:o[r])},P=(e,t)=>{/* istanbul ignore next -- @preserve */if(!e.length||!t)return console.log("Warning! Is this really happening?"),[];const[r,...n]=e.split(".");if(!n.length)return t[r]?[t[r]]:[];if(r===B){const o=[];for(const i of t){const s=P(n.join("."),i);o.push(...s)}return o}return P(n.join("."),t==null?void 0:t[r])},le=(e,t,r=E.MQTT_TOPIC)=>{const n=ce((e==null?void 0:e.configSchema)||{},r),o=[];return n.forEach(i=>{const s=P(i,t);o.push(...s)}),o},he=(e,t,r,n=!1)=>{const o=[];if(r){const i=r.reduce((s,c)=>{const{local:l,remote:p}=ue(c);return s.push(...l.map(u=>u.topic)),s.push(...p.map(u=>u.topic)),n?s.map(u=>`${c.id}/${u}`):s},[]);o.push(...i)}if(t){const i=t.reduce((s,c)=>{var u;const l=(u=e==null?void 0:e.items)==null?void 0:u.find(f=>f.id===c.type);/* istanbul ignore next -- @preserve */if(!l)return s;const p=le(l,c.config);return s.push(...n?p.map(f=>`${f} @ ${c.id}`):p),s},[]);o.push(...i)}return Array.from(new Set(o))},de=(e,t,r)=>e.map(n=>({label:n,count:1})),pe=e=>ie().path(t=>t.label)(e);export{E as C,y as N,B as T,x as a,ae as b,ue as c,le as d,ce as g,$ as h,he as m,pe as s,de as t};
//# sourceMappingURL=topics-utils-l3ij3e8P.js.map
