import{e as E,aQ as S,aR as D,Q as w,u as T,y as P,r as f,l as m,j as e,C as g,T as j,B as b,aS as R,au as y,a3 as V,h as U,D as $,M as Q,p as Y,q as K,s as Z,v as G,x as W,ap as X,aq as ee,b as te,at as C,aU as M}from"./index-cMih3SEP.js";import{h as re,i as se,j as ie,k as oe}from"./index-iD7yky8Q.js";import{u as ae}from"./useListTopicFilters-BbjQizvN.js";import{E as ne}from"./ExpandableDrawer-DCcw9WLM.js";import{T as v}from"./EntityTag-D_VD81fJ.js";import{P as ce}from"./PaginatedTable-CpimMJK6.js";import{A as le}from"./ArrayItemDrawer-uF-ZCmSZ.js";import{u as pe,J as L}from"./JsonSchemaBrowser-9_NRMvC_.js";import{a as de,g as me}from"./ArrayFieldTemplate-BvbIrrVp.js";import{D as ue}from"./toast-utils-BddXXXrS.js";import{v as he}from"./index-BXWYaCHO.js";import{C as F}from"./chunk-FHHZMTWR-BZ2wKB7t.js";import{C as k}from"./chunk-BDSTZZXD-Biup13z0.js";import{C as N}from"./chunk-2EW3JUUD-iAZ0BXIz.js";import{T as xe,a as je,b as A,c as fe,d as I}from"./chunk-IAXSQ4X2-dYM9Hy0E.js";import{N as ge}from"./NodeNameCard-yfQKWlf9.js";import{N as Fe}from"./types-DcJW2o_l.js";import"./DrawerExpandButton-BRREeAlM.js";import"./chunk-RPO2WXNL-BTibYaQa.js";import"./creatable-select-CDfhMLkq.js";import"./use-chakra-select-props-D5NVA-bJ.js";import"./chunk-KC77MHL3-CpO6TSLY.js";import"./chunk-W7WUSNWJ-DJm2I2MC.js";import"./chunk-HB6KBUMZ-BnKuEGjs.js";import"./chunk-OCNORRQU-qVjYAyQ7.js";import"./index-DDmdO6wr.js";import"./datetime-B2_BsC7v.js";import"./ChakraRJSForm-BfID56dF.js";import"./without-BTTCd72_.js";import"./ArrayFieldItemTemplate-CQ7KDBCe.js";import"./chunk-TRO7245M-Czmm3RtS.js";import"./index-UJo6opCj.js";import"./vanilla-Dd4Maacd.js";import"./color-Cs2FUV59.js";import"./index-BTlOwmq4.js";import"./chunk-LZZHVJFG-BAJsNEk_.js";import"./EntityCreatableSelect-6HDrxMJ3.js";import"./useGetDomainTags-VyBNKn6z.js";import"./useGetAdapterTypes-Dufd8ZhJ.js";import"./useListProtocolAdapters-B80RXV7q.js";import"./useListBridges-BwHrTuI4.js";import"./topics-utils-l3ij3e8P.js";import"./select-Cl6Duh2E.js";import"./useListDomainTags-DSFB0XoK.js";import"./index-C46KiF-i.js";import"./pick-DicWcAKr.js";import"./chunk-JARCRF6W-CHhnzfpl.js";import"./chunk-ZPFGWTBB-27OtcFRz.js";import"./index-C23MLgnh.js";import"./chunk-RDF2AYID-BFNDpMsD.js";import"./config.utils-FEQhkVx6.js";import"./chunk-KO6Q73AP-Bk5HKb-M.js";import"./chunk-VTV6N5LE-DWhDJEfB.js";import"./chunk-EL2VKIZQ-C-XtNqj-.js";import"./05-icon-industrial-hivemq-edge-CnZ6VqSq.js";import"./adapter.utils-B-ndd-tn.js";import"./chunk-KTD65HY5-BcgUOmvV.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},r=new t.Error().stack;r&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[r]="f236113b-9a37-442a-ba23-acf7b4f03d5b",t._sentryDebugIdIdentifier="sentry-dbid-f236113b-9a37-442a-ba23-acf7b4f03d5b")}catch{}})();const Te={description:"List of result items that are returned by this endpoint",properties:{description:{type:"string",description:"The name for this topic filter."},schema:{type:"string",description:"The optional json schema for this topic filter in the data uri format.",format:"data-url"},topicFilter:{type:"string",description:"The topic filter according to the MQTT specification.",isRequired:!0,format:"mqtt-topic-filter"}}},ye=()=>{const t=E(),r=S();return D({mutationFn:({requestBody:i})=>t.topicFilters.addTopicFilters(i),onSuccess:()=>{r.invalidateQueries({queryKey:[w.DISCOVERY_TOPIC_FILTERS]})}})},be=()=>{const t=E(),r=S();return D({mutationFn:({name:i})=>t.topicFilters.deleteTopicFilter(encodeURIComponent(i)),onSuccess:()=>{r.invalidateQueries({queryKey:[w.DISCOVERY_TOPIC_FILTERS]})}})},Ce=()=>{const t=E(),r=S();return D({mutationFn:({name:i,requestBody:n})=>t.topicFilters.updateTopicFilter(encodeURIComponent(i),n),onSuccess:()=>{r.invalidateQueries({queryKey:[w.DISCOVERY_TOPIC_FILTERS]})}})},Ee=()=>{const t=E(),r=S();return D({mutationFn:({requestBody:s})=>t.topicFilters.updateTopicFilters(s),onSuccess:()=>{r.invalidateQueries({queryKey:[w.DISCOVERY_TOPIC_FILTERS]})}})},B=()=>{const{t}=T(),r=P(),{data:s,isLoading:i,isError:n,error:a}=ae(),o=ye(),l=be(),u=Ce(),h=Ee(),x=f.useMemo(()=>({schema:{definitions:{TopicFilter:{...Te,required:["topicFilter"]}},properties:{items:{type:"array",items:{$ref:"#/definitions/TopicFilter"}}}}}),[]),p=d=>({success:{title:t(`topicFilter.toast.${d}.title`),description:t(`topicFilter.toast.${d}.description`,{context:"success"})},error:{title:t(`topicFilter.toast.${d}.title`),description:t(`topicFilter.toast.${d}.description`,{context:"error"})},loading:{title:t(`topicFilter.toast.${d}.title`),description:t("topicFilter.toast.description",{context:"loading"})}}),c=d=>{r.promise(l.mutateAsync({name:d}),p("delete"))},O=d=>{r.promise(o.mutateAsync({requestBody:d}),p("create"))},q=(d,J)=>{r.promise(u.mutateAsync({name:d,requestBody:J}),p("update"))},z=d=>{r.promise(h.mutateAsync({requestBody:d}),p("updateCollection"))};return{context:{schema:x.schema,uiSchema:{"ui:submitButtonOptions":{norender:!0},items:{"ui:title":"Topic Filters",items:{"ui:order":["topicFilter","*"],schema:{"ui:widget":"hidden"}}}},formData:s},data:s,onCreate:O,onDelete:c,onUpdate:q,onUpdateCollection:z,isLoading:i,isError:n,error:a,isPending:o.isPending||u.isPending||l.isPending||h.isPending}},_="application/json",Se="application/schema+json",De={[Se]:[".json"]},we=",",Oe=":",Me=";",Ae="data",Ie="base64",_e=t=>{const[r,s]=t.split(we);if(!s||!r)throw new Error(m.t("topicFilter.error.schema.noDataUri"));const[i,n]=r.split(Oe);if(!n)throw new Error(m.t("topicFilter.error.schema.noScheme"));if(i!==Ae)throw new Error(m.t("topicFilter.error.schema.noSchemeData"));const a=n.split(Me);if(!a.includes(_))throw new Error(m.t("topicFilter.error.schema.noJsonSchemaMimeType"));if(!a.includes(Ie))throw new Error(m.t("topicFilter.error.schema.noBase64MediaType"));try{const o=atob(s),l=JSON.parse(o);he.ajv.compile(l);const{properties:u}=l;if(!u)throw new Error(m.t("topicFilter.error.schema.ajvNoProperties"));return{mimeType:_,options:a,body:l}}catch(o){if(o instanceof SyntaxError)throw new Error(m.t("topicFilter.error.schema.noBase64Data"));if(o instanceof DOMException)throw new Error(m.t("topicFilter.error.schema.noJSON"));if(o instanceof Error)throw new Error(`${o.message}`)}},Pe=t=>`data:${_};base64,${btoa(JSON.stringify(t))}`,H=t=>{if(!t)return{status:"warning",message:m.t("topicFilter.schema.status.missing")};try{const r=_e(t);return r!=null&&r.body?{schema:r.body,status:"success",message:m.t("topicFilter.schema.status.success")}:{error:"no body from the base64 payload",status:"error",message:m.t("topicFilter.schema.status.internalError")}}catch(r){return{error:r.message,status:"error",message:m.t("topicFilter.schema.status.invalid")}}},Re=({onUpload:t})=>{const[r,s]=f.useState(!1),{t:i}=T(),n=P(),{getRootProps:a,getInputProps:o,isDragActive:l,open:u}=de({noClick:!0,noKeyboard:!0,maxFiles:1,accept:De,onDropRejected:h=>{const x="error";s(!1),h.forEach(p=>{n({...ue,status:x,title:i("rjsf.batchUpload.dropZone.status",{ns:"components",context:x,fileName:p.file.name}),description:p.errors[0].message})})},onDropAccepted:async h=>{const[x]=h,p=new FileReader;p.readAsDataURL(x),p.onload=()=>{typeof p.result=="string"&&t(p.result)}}});return e.jsx(g,{variant:"filled",children:e.jsxs(F,{...a(),...me("blue.500"),minHeight:"calc(250px - 2rem)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",id:"dropzone",children:[e.jsx("input",{...o(),"data-testid":"schema-dropzone"}),l&&e.jsx(j,{children:i("rjsf.batchUpload.dropZone.dropping",{ns:"components"})}),r&&e.jsx(j,{children:i("rjsf.batchUpload.dropZone.loading",{ns:"components"})}),!l&&!r&&e.jsxs(e.Fragment,{children:[e.jsx(j,{children:i("topicFilter.schema.actions.upload")}),e.jsx(b,{onClick:u,children:i("rjsf.batchUpload.dropZone.selectFile",{ns:"components"})})]})]})})},Ue=({topicFilter:t,onUpload:r})=>{const{t:s}=T(),{schema:i,isLoading:n,isError:a,error:o}=pe(t.topicFilter),l=f.useMemo(()=>i&&Object.keys(i).length!==0&&i.constructor===Object,[i]);return n?e.jsx(R,{}):a&&o?e.jsx(y,{message:o.message}):l?e.jsxs(g,{children:[e.jsx(F,{children:e.jsx(L,{schema:i})}),e.jsx(k,{justifyContent:"flex-end",children:e.jsx(b,{"data-testid":"schema-sampler-upload",onClick:()=>r(Pe(i)),children:s("topicFilter.schema.actions.assign")})})]}):e.jsx(y,{message:s("topicFilter.error.noSchemaSampled")})},ve=({topicFilter:t})=>{const{t:r}=T(),s=f.useMemo(()=>H(t.schema),[t.schema]),{onUpdate:i}=B(),n=o=>{i(t.topicFilter,{...t,schema:o})},a=()=>{i(t.topicFilter,{...t,schema:void 0})};return e.jsxs(V,{children:[e.jsx(y,{status:s.status,type:s.message}),e.jsxs(g,{size:"sm",children:[e.jsx(N,{children:e.jsx(j,{children:r("topicFilter.schema.prompt")})}),e.jsx(F,{children:e.jsxs(xe,{isLazy:!0,children:[e.jsxs(je,{children:[e.jsx(A,{children:r("topicFilter.schema.tabs.current")}),e.jsx(A,{children:r("topicFilter.schema.tabs.infer")}),e.jsx(A,{children:r("topicFilter.schema.tabs.upload")})]}),e.jsxs(fe,{children:[e.jsx(I,{children:e.jsxs(g,{children:[e.jsxs(F,{children:[s.error&&e.jsx(y,{message:s.error,status:s.status}),s.schema&&e.jsx(L,{schema:s.schema,hasExamples:!0})]}),e.jsx(k,{justifyContent:"flex-end",children:e.jsx(b,{isDisabled:!t.schema,onClick:a,children:r("topicFilter.schema.actions.remove")})})]})}),e.jsx(I,{children:e.jsx(Ue,{topicFilter:t,onUpload:n})}),e.jsx(I,{children:e.jsx(Re,{onUpload:n})})]})]})})]})]})},Le=({topicFilter:t,trigger:r})=>{const{t:s}=T(),i=U(),{isOpen:n,onClose:a}=i,o=()=>{a()};return e.jsxs(e.Fragment,{children:[r(i),e.jsxs($,{isOpen:n,placement:"right",size:"lg",onClose:a,closeOnOverlayClick:!1,children:[e.jsx(Q,{}),e.jsxs(Y,{children:[e.jsx(K,{}),e.jsx(Z,{children:e.jsx(j,{children:s("topicFilter.schema.header")})}),e.jsx(G,{children:e.jsxs(g,{size:"sm",children:[e.jsxs(N,{children:[e.jsx(j,{as:"span",children:s("topicFilter.schema.title")})," ",e.jsx(v,{tagTitle:t.topicFilter,mr:3})]}),e.jsx(F,{children:e.jsx(ve,{topicFilter:t})})]})}),e.jsx(W,{children:e.jsx(b,{variant:"primary",onClick:o,children:s("topicFilter.schema.submit.label")})})]})]})]})},ke=({topicFilter:t})=>{const r=f.useMemo(()=>H(t.schema),[t.schema]);return e.jsx(X,{status:r.status,size:"xs",py:1,pl:2,w:10,children:e.jsx(ee,{})})},zt=()=>{const{t}=T(),{isOpen:r,onOpen:s,onClose:i}=U(),n=te(),{data:a,context:o,isLoading:l,isError:u,onUpdateCollection:h}=B(),x=()=>{i(),n("/workspace")};f.useEffect(()=>{s()},[s]);const p=f.useMemo(()=>[{accessorKey:"topicFilter",header:t("topicFilter.listing.column.topicFilter"),cell:c=>e.jsx(v,{tagTitle:c.getValue(),mr:3})},{accessorKey:"description",header:t("topicFilter.listing.column.description"),cell:c=>e.jsx(j,{as:"span",children:c.getValue()})},{id:"hasSchema",header:t("topicFilter.listing.column.hasSchema"),cell:c=>e.jsx(ke,{topicFilter:c.row.original})},{id:"actions",header:t("topicFilter.listing.column.action"),sortingFn:void 0,cell:c=>e.jsxs(C,{role:"toolbar",children:[e.jsx(Le,{topicFilter:c.row.original,trigger:({onOpen:O})=>e.jsx(C,{size:"sm",children:e.jsx(M,{"aria-label":t("topicFilter.listing.action.view.aria-label"),icon:e.jsx(se,{}),onClick:O})})}),e.jsxs(C,{isAttached:!0,size:"sm",isDisabled:!0,children:[e.jsx(M,{"aria-label":t("topicFilter.listing.action.edit.aria-label"),icon:e.jsx(ie,{}),onClick:()=>console.log(c.row.index)}),e.jsx(M,{"aria-label":t("topicFilter.listing.action.delete.aria-label"),icon:e.jsx(oe,{}),onClick:()=>console.log(c.row.index)})]})]}),footer:()=>e.jsx(le,{header:t("topicFilter.listing.aria-label"),context:o,onSubmit:c=>{h(c)},trigger:({onOpen:c})=>e.jsx(C,{isAttached:!0,size:"sm",children:e.jsx(b,{leftIcon:e.jsx(re,{}),onClick:c,children:t("topicFilter.listing.action.add.aria-label")})})})}],[o,h,t]);return e.jsxs(ne,{header:t("topicFilter.manager.header"),subHeader:e.jsx(ge,{type:Fe.EDGE_NODE,name:t("branding.appName")}),isOpen:r,onClose:x,closeOnOverlayClick:!1,children:[l&&e.jsx(R,{}),u&&e.jsx(y,{message:t("topicFilter.error.loading")}),!l&&!u&&(a==null?void 0:a.items)&&e.jsx(g,{size:"sm",children:e.jsx(F,{children:e.jsx(ce,{"aria-label":t("topicFilter.listing.aria-label"),data:a.items,columns:p,enablePagination:!0})})})]})};export{zt as default};
//# sourceMappingURL=TopicFilterManager-1LHtgude.js.map
