import{s as W,a as N,b as P}from"./chunk-JZAHL7AJ-BNmbNENr.js";import{_ as f,c as t,l as S,d as C,j as z,u as U}from"./PropertyPanelController-B_GTknPx.js";import{s as H}from"./index-Dis5-5gm.js";import{G as D}from"./graph-fDbTnqOE.js";import{l as F}from"./layout-MfhNWExk.js";import{N as I,$ as O}from"./step-BUvoxw0L.js";import"./chunk-EICJXIV7-DCLq6afT.js";import"./index-cMih3SEP.js";import"./index-iD7yky8Q.js";import"./types-CNm55BG_.js";import"./usePolicyGuards-DliXcvYq.js";import"./useDataHubDraftStore-BdIk6zJn.js";import"./index-UJo6opCj.js";import"./vanilla-Dd4Maacd.js";import"./middleware-DWkoLS6u.js";import"./index-BXWYaCHO.js";import"./without-BTTCd72_.js";import"./index-BTlOwmq4.js";import"./ArrayFieldTemplate-BvbIrrVp.js";import"./pick-DicWcAKr.js";import"./chunk-TRO7245M-Czmm3RtS.js";import"./chunk-JARCRF6W-CHhnzfpl.js";import"./chunk-ZPFGWTBB-27OtcFRz.js";import"./chunk-W7WUSNWJ-DJm2I2MC.js";import"./index-C23MLgnh.js";import"./chunk-RDF2AYID-BFNDpMsD.js";import"./creatable-select-CDfhMLkq.js";import"./use-chakra-select-props-D5NVA-bJ.js";import"./chunk-KC77MHL3-CpO6TSLY.js";import"./chunk-HB6KBUMZ-BnKuEGjs.js";import"./chunk-OCNORRQU-qVjYAyQ7.js";import"./index-DDmdO6wr.js";import"./select-Cl6Duh2E.js";import"./config.utils-FEQhkVx6.js";import"./toast-utils-BddXXXrS.js";import"./PaginatedTable-CpimMJK6.js";import"./datetime-B2_BsC7v.js";import"./chunk-KO6Q73AP-Bk5HKb-M.js";import"./chunk-VTV6N5LE-DWhDJEfB.js";import"./chunk-RPO2WXNL-BTibYaQa.js";import"./chunk-EL2VKIZQ-C-XtNqj-.js";import"./useListProtocolAdapters-B80RXV7q.js";import"./ArrayFieldItemTemplate-CQ7KDBCe.js";import"./color-Cs2FUV59.js";import"./useGetAllSchemas-BHgSFldN.js";import"./utils-Da84xa3e.js";import"./SchemaNode.utils-CqHD45U7.js";import"./index-C46KiF-i.js";import"./useGetAllDataPolicies-C_g1xUlx.js";import"./chunk-FHHZMTWR-BZ2wKB7t.js";import"./useGetAllBehaviorPolicies-C8fnxDpN.js";import"./bump-DxSIDwFB.js";/* empty css              */import"./_baseUniq-UwA5AnXX.js";import"./_basePickBy-BpWhf_0p.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new e.Error().stack;i&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[i]="fdb5cc59-e61c-4237-8223-ab1a8e77b856",e._sentryDebugIdIdentifier="sentry-dbid-fdb5cc59-e61c-4237-8223-ab1a8e77b856")}catch{}})();var _={},J=f((e,i)=>{_[e]=i},"set"),X=f(e=>_[e],"get"),G=f(()=>Object.keys(_),"keys"),$=f(()=>G().length,"size"),Y={get:X,set:J,keys:G,size:$},j=f(e=>e.append("circle").attr("class","start-state").attr("r",t().state.sizeUnit).attr("cx",t().state.padding+t().state.sizeUnit).attr("cy",t().state.padding+t().state.sizeUnit),"drawStartState"),q=f(e=>e.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",t().state.textHeight).attr("class","divider").attr("x2",t().state.textHeight*2).attr("y1",0).attr("y2",0),"drawDivider"),Z=f((e,i)=>{const n=e.append("text").attr("x",2*t().state.padding).attr("y",t().state.textHeight+2*t().state.padding).attr("font-size",t().state.fontSize).attr("class","state-title").text(i.id),s=n.node().getBBox();return e.insert("rect",":first-child").attr("x",t().state.padding).attr("y",t().state.padding).attr("width",s.width+2*t().state.padding).attr("height",s.height+2*t().state.padding).attr("rx",t().state.radius),n},"drawSimpleState"),K=f((e,i)=>{const n=f(function(c,b,w){const E=c.append("tspan").attr("x",2*t().state.padding).text(b);w||E.attr("dy",t().state.textHeight)},"addTspan"),o=e.append("text").attr("x",2*t().state.padding).attr("y",t().state.textHeight+1.3*t().state.padding).attr("font-size",t().state.fontSize).attr("class","state-title").text(i.descriptions[0]).node().getBBox(),l=o.height,h=e.append("text").attr("x",t().state.padding).attr("y",l+t().state.padding*.4+t().state.dividerMargin+t().state.textHeight).attr("class","state-description");let a=!0,d=!0;i.descriptions.forEach(function(c){a||(n(h,c,d),d=!1),a=!1});const y=e.append("line").attr("x1",t().state.padding).attr("y1",t().state.padding+l+t().state.dividerMargin/2).attr("y2",t().state.padding+l+t().state.dividerMargin/2).attr("class","descr-divider"),x=h.node().getBBox(),p=Math.max(x.width,o.width);return y.attr("x2",p+3*t().state.padding),e.insert("rect",":first-child").attr("x",t().state.padding).attr("y",t().state.padding).attr("width",p+2*t().state.padding).attr("height",x.height+l+2*t().state.padding).attr("rx",t().state.radius),e},"drawDescrState"),Q=f((e,i,n)=>{const s=t().state.padding,o=2*t().state.padding,l=e.node().getBBox(),h=l.width,a=l.x,d=e.append("text").attr("x",0).attr("y",t().state.titleShift).attr("font-size",t().state.fontSize).attr("class","state-title").text(i.id),x=d.node().getBBox().width+o;let p=Math.max(x,h);p===h&&(p=p+o);let c;const b=e.node().getBBox();i.doc,c=a-s,x>h&&(c=(h-p)/2+s),Math.abs(a-b.x)<s&&x>h&&(c=a-(x-h)/2);const w=1-t().state.textHeight;return e.insert("rect",":first-child").attr("x",c).attr("y",w).attr("class",n?"alt-composit":"composit").attr("width",p).attr("height",b.height+t().state.textHeight+t().state.titleShift+1).attr("rx","0"),d.attr("x",c+s),x<=h&&d.attr("x",a+(p-o)/2-x/2+s),e.insert("rect",":first-child").attr("x",c).attr("y",t().state.titleShift-t().state.textHeight-t().state.padding).attr("width",p).attr("height",t().state.textHeight*3).attr("rx",t().state.radius),e.insert("rect",":first-child").attr("x",c).attr("y",t().state.titleShift-t().state.textHeight-t().state.padding).attr("width",p).attr("height",b.height+3+2*t().state.textHeight).attr("rx",t().state.radius),e},"addTitleAndBox"),V=f(e=>(e.append("circle").attr("class","end-state-outer").attr("r",t().state.sizeUnit+t().state.miniPadding).attr("cx",t().state.padding+t().state.sizeUnit+t().state.miniPadding).attr("cy",t().state.padding+t().state.sizeUnit+t().state.miniPadding),e.append("circle").attr("class","end-state-inner").attr("r",t().state.sizeUnit).attr("cx",t().state.padding+t().state.sizeUnit+2).attr("cy",t().state.padding+t().state.sizeUnit+2)),"drawEndState"),tt=f((e,i)=>{let n=t().state.forkWidth,s=t().state.forkHeight;if(i.parentId){let o=n;n=s,s=o}return e.append("rect").style("stroke","black").style("fill","black").attr("width",n).attr("height",s).attr("x",t().state.padding).attr("y",t().state.padding)},"drawForkJoinState"),et=f((e,i,n,s)=>{let o=0;const l=s.append("text");l.style("text-anchor","start"),l.attr("class","noteText");let h=e.replace(/\r\n/g,"<br/>");h=h.replace(/\n/g,"<br/>");const a=h.split(z.lineBreakRegex);let d=1.25*t().state.noteMargin;for(const y of a){const x=y.trim();if(x.length>0){const p=l.append("tspan");if(p.text(x),d===0){const c=p.node().getBBox();d+=c.height}o+=d,p.attr("x",i+t().state.noteMargin),p.attr("y",n+o+1.25*t().state.noteMargin)}}return{textWidth:l.node().getBBox().width,textHeight:o}},"_drawLongText"),at=f((e,i)=>{i.attr("class","state-note");const n=i.append("rect").attr("x",0).attr("y",t().state.padding),s=i.append("g"),{textWidth:o,textHeight:l}=et(e,0,0,s);return n.attr("height",l+2*t().state.noteMargin),n.attr("width",o+t().state.noteMargin*2),n},"drawNote"),L=f(function(e,i){const n=i.id,s={id:n,label:i.id,width:0,height:0},o=e.append("g").attr("id",n).attr("class","stateGroup");i.type==="start"&&j(o),i.type==="end"&&V(o),(i.type==="fork"||i.type==="join")&&tt(o,i),i.type==="note"&&at(i.note.text,o),i.type==="divider"&&q(o),i.type==="default"&&i.descriptions.length===0&&Z(o,i),i.type==="default"&&i.descriptions.length>0&&K(o,i);const l=o.node().getBBox();return s.width=l.width+2*t().state.padding,s.height=l.height+2*t().state.padding,Y.set(n,s),s},"drawState"),A=0,it=f(function(e,i,n){const s=f(function(d){switch(d){case N.relationType.AGGREGATION:return"aggregation";case N.relationType.EXTENSION:return"extension";case N.relationType.COMPOSITION:return"composition";case N.relationType.DEPENDENCY:return"dependency"}},"getRelationType");i.points=i.points.filter(d=>!Number.isNaN(d.y));const o=i.points,l=I().x(function(d){return d.x}).y(function(d){return d.y}).curve(O),h=e.append("path").attr("d",l(o)).attr("id","edge"+A).attr("class","transition");let a="";if(t().state.arrowMarkerAbsolute&&(a=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,a=a.replace(/\(/g,"\\("),a=a.replace(/\)/g,"\\)")),h.attr("marker-end","url("+a+"#"+s(N.relationType.DEPENDENCY)+"End)"),n.title!==void 0){const d=e.append("g").attr("class","stateLabel"),{x:y,y:x}=U.calcLabelPosition(i.points),p=z.getRows(n.title);let c=0;const b=[];let w=0,E=0;for(let u=0;u<=p.length;u++){const g=d.append("text").attr("text-anchor","middle").text(p[u]).attr("x",y).attr("y",x+c),m=g.node().getBBox();w=Math.max(w,m.width),E=Math.min(E,m.x),S.info(m.x,y,x+c),c===0&&(c=g.node().getBBox().height,S.info("Title height",c,x)),b.push(g)}let v=c*p.length;if(p.length>1){const u=(p.length-1)*c*.5;b.forEach((g,m)=>g.attr("y",x+m*c-u)),v=c*p.length}const r=d.node().getBBox();d.insert("rect",":first-child").attr("class","box").attr("x",y-w/2-t().state.padding/2).attr("y",x-v/2-t().state.padding/2-3.5).attr("width",w+t().state.padding).attr("height",v+t().state.padding),S.info(r)}A++},"drawEdge"),B,T={},rt=f(function(){},"setConf"),nt=f(function(e){e.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),ot=f(function(e,i,n,s){B=t().state;const o=t().securityLevel;let l;o==="sandbox"&&(l=H("#i"+i));const h=o==="sandbox"?H(l.nodes()[0].contentDocument.body):H("body"),a=o==="sandbox"?l.nodes()[0].contentDocument:document;S.debug("Rendering diagram "+e);const d=h.select(`[id='${i}']`);nt(d);const y=s.db.getRootDoc();R(y,d,void 0,!1,h,a,s);const x=B.padding,p=d.node().getBBox(),c=p.width+x*2,b=p.height+x*2,w=c*1.75;C(d,b,w,B.useMaxWidth),d.attr("viewBox",`${p.x-B.padding}  ${p.y-B.padding} `+c+" "+b)},"draw"),dt=f(e=>e?e.length*B.fontSizeFactor:1,"getLabelWidth"),R=f((e,i,n,s,o,l,h)=>{const a=new D({compound:!0,multigraph:!0});let d,y=!0;for(d=0;d<e.length;d++)if(e[d].stmt==="relation"){y=!1;break}n?a.setGraph({rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:y?1:B.edgeLengthFactor,nodeSep:y?1:50,isMultiGraph:!0}):a.setGraph({rankdir:"TB",multigraph:!0,compound:!0,ranksep:y?1:B.edgeLengthFactor,nodeSep:y?1:50,ranker:"tight-tree",isMultiGraph:!0}),a.setDefaultEdgeLabel(function(){return{}}),h.db.extract(e);const x=h.db.getStates(),p=h.db.getRelations(),c=Object.keys(x);for(const r of c){const u=x[r];n&&(u.parentId=n);let g;if(u.doc){let m=i.append("g").attr("id",u.id).attr("class","stateGroup");g=R(u.doc,m,u.id,!s,o,l,h);{m=Q(m,u,s);let k=m.node().getBBox();g.width=k.width,g.height=k.height+B.padding/2,T[u.id]={y:B.compositTitleSize}}}else g=L(i,u,a);if(u.note){const m={descriptions:[],id:u.id+"-note",note:u.note,type:"note"},k=L(i,m,a);u.note.position==="left of"?(a.setNode(g.id+"-note",k),a.setNode(g.id,g)):(a.setNode(g.id,g),a.setNode(g.id+"-note",k)),a.setParent(g.id,g.id+"-group"),a.setParent(g.id+"-note",g.id+"-group")}else a.setNode(g.id,g)}S.debug("Count=",a.nodeCount(),a);let b=0;p.forEach(function(r){b++,S.debug("Setting edge",r),a.setEdge(r.id1,r.id2,{relation:r,width:dt(r.title),height:B.labelHeight*z.getRows(r.title).length,labelpos:"c"},"id"+b)}),F(a),S.debug("Graph after layout",a.nodes());const w=i.node();a.nodes().forEach(function(r){r!==void 0&&a.node(r)!==void 0?(S.warn("Node "+r+": "+JSON.stringify(a.node(r))),o.select("#"+w.id+" #"+r).attr("transform","translate("+(a.node(r).x-a.node(r).width/2)+","+(a.node(r).y+(T[r]?T[r].y:0)-a.node(r).height/2)+" )"),o.select("#"+w.id+" #"+r).attr("data-x-shift",a.node(r).x-a.node(r).width/2),l.querySelectorAll("#"+w.id+" #"+r+" .divider").forEach(g=>{const m=g.parentElement;let k=0,M=0;m&&(m.parentElement&&(k=m.parentElement.getBBox().width),M=parseInt(m.getAttribute("data-x-shift"),10),Number.isNaN(M)&&(M=0)),g.setAttribute("x1",0-M+8),g.setAttribute("x2",k-M-8)})):S.debug("No Node "+r+": "+JSON.stringify(a.node(r)))});let E=w.getBBox();a.edges().forEach(function(r){r!==void 0&&a.edge(r)!==void 0&&(S.debug("Edge "+r.v+" -> "+r.w+": "+JSON.stringify(a.edge(r))),it(i,a.edge(r),a.edge(r).relation))}),E=w.getBBox();const v={id:n||"root",label:n||"root",width:0,height:0};return v.width=E.width+2*B.padding,v.height=E.height+2*B.padding,S.debug("Doc rendered",v,a),v},"renderDoc"),st={setConf:rt,draw:ot},ce={parser:P,db:N,renderer:st,styles:W,init:f(e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute,N.clear()},"init")};export{ce as diagram};
//# sourceMappingURL=stateDiagram-GNSP7T6Y-BwriyR-m.js.map
