import{e as D,aR as C,bP as T,u as f,b as z,j as e,at as v,aU as L,a2 as W,r as h,bQ as $,bR as J,T as u,bS as X,bT as Z,h as ee,y as te}from"./index-cMih3SEP.js";import{C as se}from"./ConfirmationDialog-D4ZhAtlq.js";import{D as j}from"./datetime-B2_BsC7v.js";import{D as F}from"./DateTimeRenderer-DMb4YVpb.js";import{P as V}from"./PaginatedTable-CpimMJK6.js";import{b as p,D as ie,a as Q}from"./types-CNm55BG_.js";import{u as ae}from"./useGetAllBehaviorPolicies-C8fnxDpN.js";import{D as E}from"./utils-Da84xa3e.js";import{u as re}from"./useGetAllDataPolicies-C_g1xUlx.js";import{c as I,d as K,e as ne,f as oe}from"./index-iD7yky8Q.js";import{u as q}from"./useDataHubDraftStore-BdIk6zJn.js";import{d as R}from"./download.utils-CFO8eGS0.js";import{S as c}from"./chunk-GOJLRND4-gY5DQ7Jj.js";import{u as ce,a as de}from"./useGetAllSchemas-BHgSFldN.js";import{d as Y}from"./toast.utils-DGAijIrh.js";import{T as le,a as ue,b as M,c as pe,d as _}from"./chunk-IAXSQ4X2-dYM9Hy0E.js";import"./chunk-EL2VKIZQ-C-XtNqj-.js";import"./creatable-select-CDfhMLkq.js";import"./use-chakra-select-props-D5NVA-bJ.js";import"./chunk-KC77MHL3-CpO6TSLY.js";import"./chunk-W7WUSNWJ-DJm2I2MC.js";import"./chunk-HB6KBUMZ-BnKuEGjs.js";import"./chunk-OCNORRQU-qVjYAyQ7.js";import"./index-DDmdO6wr.js";import"./index-UJo6opCj.js";import"./vanilla-Dd4Maacd.js";import"./middleware-DWkoLS6u.js";import"./index-Dis5-5gm.js";import"./index-C23MLgnh.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new t.Error().stack;i&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[i]="a18383b1-b1a9-4428-a978-57df31264233",t._sentryDebugIdIdentifier="sentry-dbid-a18383b1-b1a9-4428-a978-57df31264233")}catch{}})();const he=()=>{const t=D();return C({mutationFn:i=>t.dataHubDataPolicies.deleteDataPolicy(i),onSuccess:()=>{T.invalidateQueries({queryKey:[E.DATA_POLICIES]})}})},me=()=>{const t=D();return C({mutationFn:i=>t.dataHubBehaviorPolicies.deleteBehaviorPolicy(i),onSuccess:()=>{T.invalidateQueries({queryKey:[E.BEHAVIOR_POLICIES]})}})},k=({policy:t,onEdit:i,onDelete:r,onDownload:o})=>{const{t:n}=f("datahub"),l=z(),{setStatus:d}=q();return t?(t==null?void 0:t.type)===p.CREATE_POLICY?e.jsxs(v,{size:"sm",isAttached:!0,children:[e.jsx(L,{"data-testid":"list-action-view",onClick:()=>{d(ie.DRAFT),l(`/datahub/${p.CREATE_POLICY}`)},"aria-label":n("Listings.policy.action.draft"),icon:e.jsx(ne,{})}),e.jsx(L,{"data-testid":"list-action-delete",onClick:r,"aria-label":n("Listings.action.delete"),icon:e.jsx(K,{})})]}):e.jsx(W,{children:e.jsxs(v,{size:"sm",isAttached:!0,children:[e.jsx(L,{"data-testid":"list-action-view",onClick:i,"aria-label":n("Listings.action.view-edit"),icon:e.jsx(oe,{})}),e.jsx(L,{"data-testid":"list-action-download",onClick:o,"aria-label":n("Listings.action.download"),icon:e.jsx(I,{})}),e.jsx(L,{"data-testid":"list-action-delete",onClick:r,"aria-label":n("Listings.action.delete"),icon:e.jsx(K,{})})]})}):e.jsxs(v,{size:"sm",isAttached:!0,children:[e.jsx(L,{"data-testid":"list-action-download",onClick:o,"aria-label":n("Listings.action.download"),icon:e.jsx(I,{})}),e.jsx(L,{"data-testid":"list-action-delete",onClick:r,"aria-label":n("Listings.action.delete"),icon:e.jsx(K,{})})]})},ge=({onDeleteItem:t})=>{const{t:i}=f("datahub"),{isLoading:r,data:o,isError:n}=re(),{isLoading:l,data:d,isError:m}=ae({}),g=z(),s=he(),b=me(),{isDirty:O,reset:S}=q(),G=h.useMemo(()=>n||m,[n,m]),y=h.useMemo(()=>r||l,[r,l]),B=O(),N=h.useMemo(()=>{if(y)return[{...$,type:p.DATA_POLICY},{...J,type:p.BEHAVIOR_POLICY}];const P=()=>({type:p.CREATE_POLICY,id:"",createdAt:j.now().toISO(),matching:{topicFilter:""}});function w(a,x){return a?a.map(H=>({...H,type:x})):[]}const A=[...w(o==null?void 0:o.items,p.DATA_POLICY),...w(d==null?void 0:d.items,p.BEHAVIOR_POLICY)];return B&&A.unshift(P()),A},[y,B,o==null?void 0:o.items,d==null?void 0:d.items]),U=h.useMemo(()=>{const P=a=>{if(a.row.original.type===p.CREATE_POLICY){S();return}const x=a.row.original.type===p.DATA_POLICY?s:b;t==null||t(x.mutateAsync,a.row.original.type,a.row.original.id)},w=a=>()=>{g(`/datahub/${a.row.original.type}/${a.row.original.id}`)},A=a=>()=>{const{type:x,...H}=a.row.original;R(a.row.original.id,H)};return[{accessorKey:"id",cell:a=>e.jsx(c,{isLoaded:!y,whiteSpace:"nowrap",children:e.jsx(u,{children:a.getValue()})})},{accessorKey:"type",cell:a=>e.jsx(c,{isLoaded:!y,whiteSpace:"nowrap",children:e.jsx(u,{children:i("policy.type",{context:a.getValue()})})}),header:i("Listings.policy.header.type")},{accessorKey:"matching",cell:a=>{const x=a.getValue();return e.jsx(c,{isLoaded:!y,whiteSpace:"nowrap",children:e.jsx(u,{children:x.topicFilter||x.clientIdRegex})})},header:i("Listings.policy.header.matching")},{accessorKey:"createdAt",sortType:"datetime",accessorFn:a=>a.createdAt?j.fromISO(a.createdAt).toMillis():void 0,cell:a=>e.jsx(c,{isLoaded:!y,whiteSpace:"nowrap",children:e.jsx(F,{date:j.fromMillis(a.getValue()),isApprox:!0})}),header:i("Listings.policy.header.created")},{id:"actions",header:i("Listings.policy.header.actions"),sortingFn:void 0,cell:a=>e.jsx(c,{isLoaded:!y,children:e.jsx(k,{policy:a.row.original,onDelete:()=>P(a),onEdit:w(a),onDownload:A(a)})})}]},[b,s,y,g,t,S,i]);return e.jsx(V,{"aria-label":i("Listings.policy.label"),data:N,columns:U,isError:G})},ye=()=>{const t=D();return C({mutationFn:i=>t.dataHubSchemas.deleteSchema(i),onSuccess:()=>{T.invalidateQueries({queryKey:[E.SCHEMAS]})}})},xe=({onDeleteItem:t})=>{const{t:i}=f("datahub"),{isLoading:r,data:o,isError:n}=ce(),l=ye(),d=h.useMemo(()=>r?[X]:[...(o==null?void 0:o.items)||[]],[r,o==null?void 0:o.items]),m=h.useMemo(()=>{const g=s=>()=>{R(s.row.original.id,s.row.original)};return[{accessorKey:"id",cell:s=>e.jsx(c,{isLoaded:!r,whiteSpace:"nowrap",children:e.jsx(u,{children:s.getValue()})}),header:i("Listings.schema.header.id")},{accessorKey:"type",cell:s=>e.jsx(c,{isLoaded:!r,whiteSpace:"nowrap",children:e.jsx(u,{children:i("resource.schema.type",{context:s.getValue()})})}),header:i("Listings.schema.header.type")},{accessorKey:"version",cell:s=>e.jsx(c,{isLoaded:!r,whiteSpace:"nowrap",children:e.jsx(u,{children:s.getValue()})}),header:i("Listings.schema.header.version")},{accessorKey:"createdAt",sortType:"datetime",accessorFn:s=>s.createdAt?j.fromISO(s.createdAt).toMillis():void 0,cell:s=>e.jsx(c,{isLoaded:!r,whiteSpace:"nowrap",children:e.jsx(F,{date:j.fromMillis(s.getValue()),isApprox:!0})}),header:i("Listings.schema.header.created")},{id:"actions",header:i("Listings.schema.header.actions"),sortingFn:void 0,cell:s=>e.jsx(c,{isLoaded:!r,children:e.jsx(k,{onDelete:()=>t==null?void 0:t(l.mutateAsync,Q.SCHEMA,s.row.original.id),onDownload:g(s)})})}]},[l.mutateAsync,r,t,i]);return e.jsx(V,{"aria-label":i("Listings.schema.label"),data:d,columns:m,isError:n})},Le=()=>{const t=D();return C({mutationFn:i=>t.dataHubScripts.deleteScript(i),onSuccess:()=>{T.invalidateQueries({queryKey:[E.SCRIPTS]})}})},je=({onDeleteItem:t})=>{const{t:i}=f("datahub"),{isLoading:r,data:o,isError:n}=de({}),l=Le(),d=h.useMemo(()=>r?[Z]:[...(o==null?void 0:o.items)||[]],[r,o==null?void 0:o.items]),m=h.useMemo(()=>{const g=s=>()=>{R(s.row.original.id,s.row.original)};return[{accessorKey:"id",cell:s=>e.jsx(c,{isLoaded:!r,whiteSpace:"nowrap",children:e.jsx(u,{children:s.getValue()})}),header:i("Listings.script.header.id")},{accessorKey:"functionType",cell:s=>e.jsx(c,{isLoaded:!r,whiteSpace:"nowrap",children:e.jsx(u,{children:i("resource.script.functionType",{context:s.getValue()})})}),header:i("Listings.script.header.functionType")},{accessorKey:"version",cell:s=>e.jsx(c,{isLoaded:!r,whiteSpace:"nowrap",children:e.jsx(u,{children:s.getValue()})}),header:i("Listings.script.header.version")},{accessorKey:"description",cell:s=>e.jsx(c,{isLoaded:!r,whiteSpace:"nowrap",children:e.jsx(u,{children:s.getValue()})}),header:i("Listings.script.header.description")},{accessorKey:"createdAt",sortType:"datetime",accessorFn:s=>s.createdAt?j.fromISO(s.createdAt).toMillis():void 0,cell:s=>e.jsx(c,{isLoaded:!r,whiteSpace:"nowrap",children:e.jsx(F,{date:j.fromMillis(s.getValue()),isApprox:!0})}),header:i("Listings.script.header.created")},{id:"actions",header:i("Listings.script.header.actions"),sortingFn:void 0,cell:s=>e.jsx(c,{isLoaded:!r,children:e.jsx(k,{onDelete:()=>t==null?void 0:t(l.mutateAsync,Q.FUNCTION,s.row.original.id),onDownload:g(s)})})}]},[l.mutateAsync,r,t,i]);return e.jsx(V,{"aria-label":i("Listings.script.label"),data:d,columns:m,isError:n})},We=()=>{const{t}=f("datahub"),{isOpen:i,onOpen:r,onClose:o}=ee(),[n,l]=h.useState(void 0),d=te(),m=()=>{o(),l(void 0)},g=()=>{n==null||n.mutation(n==null?void 0:n.id).then(()=>d({...Y,title:t("error.delete.title",{source:n==null?void 0:n.type}),status:"success"})).catch(b=>d({...Y,title:t("error.delete.error",{source:n==null?void 0:n.type}),description:b.toString(),status:"error"}))},s=(b,O,S)=>{r(),l({mutation:b,type:O,id:S})};return e.jsxs(le,{isLazy:!0,colorScheme:"brand","data-testid":"list-tabs",children:[e.jsxs(ue,{children:[e.jsx(M,{fontSize:"lg",fontWeight:"bold",children:t("Listings.tabs.policy.title")}),e.jsx(M,{fontSize:"lg",fontWeight:"bold",children:t("Listings.tabs.schema.title")}),e.jsx(M,{fontSize:"lg",fontWeight:"bold",children:t("Listings.tabs.script.title")})]}),e.jsxs(pe,{children:[e.jsxs(_,{children:[e.jsx(u,{mb:3,children:t("Listings.tabs.policy.description")}),e.jsx(ge,{onDeleteItem:s})]}),e.jsxs(_,{children:[e.jsx(u,{mb:3,children:t("Listings.tabs.schema.description")}),e.jsx(xe,{onDeleteItem:s})]}),e.jsxs(_,{children:[e.jsx(u,{mb:3,children:t("Listings.tabs.script.description")}),e.jsx(je,{onDeleteItem:s})]})]}),e.jsx(se,{isOpen:i,onClose:m,onSubmit:g,message:t("Listings.modal.delete.message"),header:t("Listings.modal.delete.header")})]})};export{We as default};
//# sourceMappingURL=DataHubListings-BSz2DbKK.js.map
