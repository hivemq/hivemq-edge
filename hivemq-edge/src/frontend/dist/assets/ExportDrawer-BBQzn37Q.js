import{u as G,h as H,y as $,i as q,b as B,r as A,a6 as k,j as e,D as z,M as U,p as L,q as W,s as J,T as S,a2 as K,a0 as X,v as Q,m as Y,a7 as y,a8 as _,a9 as D,a3 as Z,aa as C,x as tt,F as et,B as ot}from"./index-cMih3SEP.js";import{E as F,A as j,P as at}from"./types-B4vn0nsI.js";import{u as rt}from"./useGetAdapterInfo-Cm4qHvTi.js";import{a as st,u as T,w as nt}from"./config.utils-FEQhkVx6.js";import{g as P,T as I,a as it,b as lt}from"./topics-utils-l3ij3e8P.js";import{d as dt,a as pt}from"./download.utils-CFO8eGS0.js";import{v as ct}from"./index-BXWYaCHO.js";import{D as M}from"./toast-utils-BddXXXrS.js";import{S as mt}from"./select-Cl6Duh2E.js";import{R as ft,a as xt}from"./chunk-RDF2AYID-BFNDpMsD.js";import"./useGetAdapterTypes-Dufd8ZhJ.js";import"./useListProtocolAdapters-B80RXV7q.js";import"./datetime-B2_BsC7v.js";import"./without-BTTCd72_.js";import"./use-chakra-select-props-D5NVA-bJ.js";import"./chunk-KC77MHL3-CpO6TSLY.js";import"./chunk-W7WUSNWJ-DJm2I2MC.js";import"./chunk-HB6KBUMZ-BnKuEGjs.js";import"./chunk-OCNORRQU-qVjYAyQ7.js";import"./index-DDmdO6wr.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},p=new t.Error().stack;p&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[p]="c5354e7c-9b94-4544-a152-fd9a838704e0",t._sentryDebugIdIdentifier="sentry-dbid-c5354e7c-9b94-4544-a152-fd9a838704e0")}catch{}})();const ut=31,ht=t=>t.substring(0,ut),O=[{value:F.Type.CONFIGURATION,formats:[".json"],downloader:(t,p,n,h,r)=>{dt(t,n),r==null||r()}},{value:F.Type.MAPPINGS,formats:Object.values(st).flat(),isDisabled:t=>t?!P(t.configSchema||{}).some(n=>n.includes(`.${I}.`)):!0,downloader:(t,p,n,h,r)=>{bt(`${t}-${pt()}${p}`,n,h),r==null||r()}}],bt=(t,p,n)=>{const r=P(n.configSchema||{}).find(l=>l.includes(`.${I}.`));if(!r)throw new j("protocolAdapter.export.error.noMapping");const f=r.split(`.${I}.`).shift();if(!f)throw new j("protocolAdapter.export.error.noMapping");const b=it(r,n.configSchema);if(!b)throw new j("protocolAdapter.export.error.noSchema");let i=lt(f,p.config||{});if(i!=null&&i.length){if(!ct.ajv.compile({type:"array",items:{properties:b}})(i))throw new j("protocolAdapter.export.error.notValid")}else{const l=Object.keys(b).map(u=>[u,""]);i=[Object.fromEntries(l)]}const m=T.json_to_sheet(i),g=T.book_new();T.book_append_sheet(g,m,ht(f));const w=i.reduce((l,u)=>Object.values(u).map((c,v)=>Math.max(10,c.toString().length,l[v]||0)),[]);m["!cols"]=w.map(l=>({wch:l})),nt(g,t,{compression:!0})},Gt=()=>{const{t}=G(),{isOpen:p,onOpen:n,onClose:h}=H(),r=$(),{adapterId:f}=q(),b=B(),{protocol:i,adapter:m}=rt(f),{name:g,logoUrl:w}=i||{},[l,u]=A.useState([]),c=k({mode:"all",criteriaMode:"all",defaultValues:{content:F.Type.CONFIGURATION}}),v=c.watch("content");A.useEffect(()=>{f&&n()},[f,n]),A.useEffect(()=>{var d;const s=O.find(a=>a.value===v);if(s){const a=((d=s.formats)==null?void 0:d.map(o=>({label:o,value:o,description:""})))||[];u(a),a.length&&c.setValue("format",a[0].value)}},[c,v]);const N=()=>{h(),b("/protocol-adapters",{state:{protocolAdapterTabIndex:at.PROTOCOLS}})},R=s=>{var a;const d=O.find(o=>o.value===s.content);if(d&&m&&i)try{(a=d.downloader)==null||a.call(d,m.id,s.format,m,i);const o="success";r({...M,status:o,title:t("protocolAdapter.export.download.status",{context:o,name:m.id})})}catch(o){let x;o instanceof j?x=t(o.message):o instanceof Error?x=o.message:x=String(o);const E="error";r({...M,status:E,title:t("protocolAdapter.export.download.status",{context:E,name:m.id}),description:x})}},V=O.map(s=>({...s,label:t("protocolAdapter.export.formats.label",{context:s.value}),description:t("protocolAdapter.export.formats.description",{context:s.value})}));return e.jsxs(z,{variant:"hivemq",closeOnOverlayClick:!1,size:"md",isOpen:p,placement:"right",onClose:N,children:[e.jsx(U,{}),e.jsxs(L,{"aria-label":t("protocolAdapter.export.header"),children:[e.jsx(W,{}),e.jsxs(J,{borderBottomWidth:"1px",children:[e.jsx(S,{"data-testid":"adapter-export-title",children:t("protocolAdapter.export.header")}),e.jsxs(K,{children:[e.jsx(X,{boxSize:"30px",objectFit:"scale-down",src:w,"aria-label":g}),e.jsx(S,{"data-testid":"adapter-export-type",fontSize:"md",fontWeight:"500",children:g})]})]}),e.jsx(Q,{children:e.jsxs(Y.form,{id:"adapter-export-form",onSubmit:c.handleSubmit(R),style:{display:"flex",flexDirection:"column",gap:"18px"},children:[e.jsxs(y,{variant:"hivemq",children:[e.jsx(_,{as:"legend",htmlFor:"field-content","data-testid":"field-content-label",children:t("protocolAdapter.export.form.content.label")}),e.jsx(D,{name:"content",control:c.control,render:({field:{value:s,...d}})=>e.jsx(ft,{...d,value:s.toString(),id:"field-content","data-testid":"field-content-options",children:e.jsx(Z,{alignItems:"flex-start",gap:6,children:V.map(a=>{var x;const o=(x=a.isDisabled)==null?void 0:x.call(a,i);return e.jsx(y,{as:"div",w:"-webkit-fill-available",isDisabled:o,children:e.jsxs(xt,{value:a.value,children:[e.jsxs(S,{children:[a.label," "]}),e.jsx(C,{as:"p",children:a.description}),o&&e.jsx(C,{as:"p",children:t("protocolAdapter.export.formats.notAvailable")})]})},a.value)})})})})]}),e.jsxs(y,{variant:"hivemq",children:[e.jsx(_,{as:"legend",htmlFor:"field-format","data-testid":"field-format-label",children:t("protocolAdapter.export.form.format.label")}),e.jsx(D,{name:"format",control:c.control,rules:{required:t("protocolAdapter.export.form.format.aria-label")},render:({field:{value:s,onChange:d,...a}})=>e.jsx(mt,{...a,id:"field-format",isDisabled:l.length===1,instanceId:"field-format.toto","aria-label":t("protocolAdapter.export.form.format.aria-label"),onChange:o=>d(o==null?void 0:o.value),value:{label:s,value:s,description:""},options:l})})]})]})}),e.jsx(tt,{borderTopWidth:"1px",children:e.jsx(et,{flexGrow:1,justifyContent:"flex-end",children:e.jsx(ot,{variant:"primary",isDisabled:!c.formState.isValid,type:"submit",form:"adapter-export-form",children:t("protocolAdapter.export.action.export")})})})]})]})};export{Gt as default};
//# sourceMappingURL=ExportDrawer-BBQzn37Q.js.map
