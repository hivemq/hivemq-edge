"use strict";var e=require("lodash/uniq"),t=require("lodash/uniqBy"),n=require("lodash/sortBy"),r=require("lodash/last"),a=require("lodash/isDate"),i=require("d3-time-format"),o=require("d3-scale"),u=require("d3-time");function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c.apply(this,arguments)}var s=[function(e){return e.setMilliseconds(0)},function(e){return e.setSeconds(0)},function(e){return e.setMinutes(0)},function(e){return e.setHours(0)},function(e){return e.setDate(1)},function(e){return e.setMonth(0)}],d={millisecond:[],second:s.slice(0,1),minute:s.slice(0,2),hour:s.slice(0,3),day:s.slice(0,4),month:s.slice(0,5),year:s.slice(0,6)},l=function(e){return function(t){return d[e].forEach((function(e){e(t)})),t}},f=function(e){var t=e.format,n=void 0===t?"native":t,r=e.precision,a=void 0===r?"millisecond":r,o=e.useUTC,u=void 0===o||o,c=l(a);return function(e){if(void 0===e)return e;if("native"===n||e instanceof Date)return c(e);var t=u?i.utcParse(n):i.timeParse(n);return c(t(e))}},m=function(e,t,n,r){var a,i,u,c,s=e.min,d=void 0===s?0:s,l=e.max,f=void 0===l?"auto":l,m=e.stacked,p=void 0!==m&&m,y=e.reverse,x=void 0!==y&&y,h=e.clamp,g=void 0!==h&&h,S=e.nice,k=void 0!==S&&S;"auto"===d?a=!0===p?null!=(i=t.minStacked)?i:0:t.min:a=d;"auto"===f?u=!0===p?null!=(c=t.maxStacked)?c:0:t.max:u=f;var T=o.scaleLinear().rangeRound("x"===r?[0,n]:[n,0]).domain(x?[u,a]:[a,u]).clamp(g);return!0===k?T.nice():"number"==typeof k&&T.nice(k),v(T,p)},v=function(e,t){void 0===t&&(t=!1);var n=e;return n.type="linear",n.stacked=t,n},p=function(e,t,n){var r=o.scalePoint().range([0,n]).domain(t.all);return r.type="point",r},y=function(e,t,n,r){var a=e.round,i=void 0===a||a,u=o.scaleBand().range("x"===r?[0,n]:[n,0]).domain(t.all).round(i);return x(u)},x=function(e){var t=e;return t.type="band",t},h=function(e,t,n){var r,a,i=e.format,u=void 0===i?"native":i,c=e.precision,s=void 0===c?"millisecond":c,d=e.min,l=void 0===d?"auto":d,m=e.max,v=void 0===m?"auto":m,p=e.useUTC,y=void 0===p||p,x=e.nice,h=void 0!==x&&x,g=f({format:u,precision:s,useUTC:y});r="auto"===l?g(t.min):"native"!==u?g(l):l,a="auto"===v?g(t.max):"native"!==u?g(v):v;var S=y?o.scaleUtc():o.scaleTime();S.range([0,n]),r&&a&&S.domain([r,a]),!0===h?S.nice():"object"!=typeof h&&"number"!=typeof h||S.nice(h);var k=S;return k.type="time",k.useUTC=y,k},g=function(e,t,n,r){var a,i=e.base,u=void 0===i?10:i,c=e.min,s=void 0===c?"auto":c,d=e.max,l=void 0===d?"auto":d;if(t.all.some((function(e){return 0===e})))throw new Error("a log scale domain must not include or cross zero");var f,m,v=!1;if(t.all.filter((function(e){return null!=e})).forEach((function(e){v||(void 0===a?a=Math.sign(e):Math.sign(e)!==a&&(v=!0))})),v)throw new Error("a log scale domain must be strictly-positive or strictly-negative");f="auto"===s?t.min:s,m="auto"===l?t.max:l;var p=o.scaleLog().domain([f,m]).rangeRound("x"===r?[0,n]:[n,0]).base(u).nice();return p.type="log",p},S=function(e,t,n,r){var a,i,u=e.constant,c=void 0===u?1:u,s=e.min,d=void 0===s?"auto":s,l=e.max,f=void 0===l?"auto":l,m=e.reverse,v=void 0!==m&&m;a="auto"===d?t.min:d,i="auto"===f?t.max:f;var p=o.scaleSymlog().constant(c).rangeRound("x"===r?[0,n]:[n,0]).nice();!0===v?p.domain([i,a]):p.domain([a,i]);var y=p;return y.type="symlog",y},k=function(e){return"x"===e?"y":"x"},T=function(e,t){return e===t},M=function(e,t){return e.getTime()===t.getTime()};function b(e,t,n,r){switch(e.type){case"linear":return m(e,t,n,r);case"point":return p(e,t,n);case"band":return y(e,t,n,r);case"time":return h(e,t,n);case"log":return g(e,t,n,r);case"symlog":return S(e,t,n,r);default:throw new Error("invalid scale spec")}}var w=function(e,t,n){var r;if("stacked"in n&&n.stacked){var a=e.data["x"===t?"xStacked":"yStacked"];return null==a?null:n(a)}return null!=(r=n(e.data[t]))?r:null},E=function(e,t,n){return{x:D(e,"x",t),y:D(e,"y",n)}},D=function(a,i,o,u){var c=void 0===u?{}:u,s=c.getValue,d=void 0===s?function(e){return e.data[i]}:s,l=c.setValue,m=void 0===l?function(e,t){e.data[i]=t}:l;if("linear"===o.type)a.forEach((function(e){e.data.forEach((function(e){var t=d(e);t&&m(e,parseFloat(String(t)))}))}));else if("time"===o.type&&"native"!==o.format){var v=f(o);a.forEach((function(e){e.data.forEach((function(e){var t=d(e);t&&m(e,v(t))}))}))}var p=[];switch(a.forEach((function(e){e.data.forEach((function(e){p.push(d(e))}))})),o.type){case"linear":var y=n(e(p).filter((function(e){return null!==e})),(function(e){return e}));return{all:y,min:Math.min.apply(Math,y),max:Math.max.apply(Math,y)};case"time":var x=t(p,(function(e){return e.getTime()})).slice(0).sort((function(e,t){return t.getTime()-e.getTime()})).reverse();return{all:x,min:x[0],max:r(x)};default:var h=e(p);return{all:h,min:h[0],max:r(h)}}},C=function(e,t,n){var i=k(e),o=[];t[i].all.forEach((function(t){var u=a(t)?M:T,c=[];n.forEach((function(n){var a=n.data.find((function(e){return u(e.data[i],t)})),s=null,d=null;if(void 0!==a){if(null!==(s=a.data[e])){var l=r(c);void 0===l?d=s:null!==l&&(d=l+s)}a.data["x"===e?"xStacked":"yStacked"]=d}c.push(d),null!==d&&o.push(d)}))})),t[e].minStacked=Math.min.apply(Math,o),t[e].maxStacked=Math.max.apply(Math,o)},q=function(e,t){return C("x",e,t)},U=function(e,t){return C("y",e,t)},O=u.timeInterval((function(e){return e.setHours(0,0,0,0)}),(function(e,t){return e.setDate(e.getDate()+t)}),(function(e,t){return(t.getTime()-e.getTime())/864e5}),(function(e){return Math.floor(e.getTime()/864e5)})),P=u.timeInterval((function(e){return e.setUTCHours(0,0,0,0)}),(function(e,t){return e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t.getTime()-e.getTime())/864e5}),(function(e){return Math.floor(e.getTime()/864e5)})),j={millisecond:[u.timeMillisecond,u.utcMillisecond],second:[u.timeSecond,u.utcSecond],minute:[u.timeMinute,u.utcMinute],hour:[u.timeHour,u.utcHour],day:[O,P],week:[u.timeWeek,u.utcWeek],sunday:[u.timeSunday,u.utcSunday],monday:[u.timeMonday,u.utcMonday],tuesday:[u.timeTuesday,u.utcTuesday],wednesday:[u.timeWednesday,u.utcWednesday],thursday:[u.timeThursday,u.utcThursday],friday:[u.timeFriday,u.utcFriday],saturday:[u.timeSaturday,u.utcSaturday],month:[u.timeMonth,u.utcMonth],year:[u.timeYear,u.utcYear]},B=Object.keys(j),A=new RegExp("^every\\s*(\\d+)?\\s*("+B.join("|")+")s?$","i");exports.castBandScale=x,exports.castLinearScale=v,exports.castPointScale=function(e){var t=e;return t.type="point",t},exports.centerScale=function(e){var t=e.bandwidth();if(0===t)return e;var n=t/2;return e.round()&&(n=Math.round(n)),function(t){var r;return(null!=(r=e(t))?r:0)+n}},exports.compareDateValues=M,exports.compareValues=T,exports.computeScale=b,exports.computeXYScalesForSeries=function(e,t,n,r,a){var i=e.map((function(e){return function(e){return c({},e,{data:e.data.map((function(e){return{data:c({},e)}}))})}(e)})),o=E(i,t,n);"stacked"in t&&!0===t.stacked&&q(o,i),"stacked"in n&&!0===n.stacked&&U(o,i);var u=b(t,o.x,r,"x"),s=b(n,o.y,a,"y"),d=i.map((function(e){return c({},e,{data:e.data.map((function(e){return c({},e,{position:{x:w(e,"x",u),y:w(e,"y",s)}})}))})}));return c({},o,{series:d,xScale:u,yScale:s})},exports.createBandScale=y,exports.createDateNormalizer=f,exports.createLinearScale=m,exports.createLogScale=g,exports.createPointScale=p,exports.createPrecisionMethod=l,exports.createSymlogScale=S,exports.createTimeScale=h,exports.generateSeriesAxis=D,exports.generateSeriesXY=E,exports.getOtherAxis=k,exports.getScaleTicks=function(e,t){if(Array.isArray(t))return t;if("string"==typeof t&&"useUTC"in e){var n=t.match(A);if(n){var r=n[1],a=n[2],i=j[a][e.useUTC?1:0];if("day"===a){var o,u,c=e.domain(),s=c[0],d=c[1],l=new Date(d);return l.setDate(l.getDate()+1),null!=(o=null==(u=i.every(Number(null!=r?r:1)))?void 0:u.range(s,l))?o:[]}if(void 0===r)return e.ticks(i);var f=i.every(Number(r));if(f)return e.ticks(f)}throw new Error("Invalid tickValues: "+t)}if("ticks"in e){if(void 0===t)return e.ticks();if("number"==typeof(m=t)&&isFinite(m)&&Math.floor(m)===m)return e.ticks(t)}var m;return e.domain()},exports.precisionCutOffs=s,exports.precisionCutOffsByType=d,exports.stackAxis=C,exports.timePrecisions=["millisecond","second","minute","hour","day","month","year"];
//# sourceMappingURL=nivo-scales.cjs.js.map
