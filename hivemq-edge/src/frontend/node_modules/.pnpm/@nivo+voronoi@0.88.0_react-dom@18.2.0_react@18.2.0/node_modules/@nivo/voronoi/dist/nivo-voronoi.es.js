import{useMemo as n,useState as o,useRef as e,useEffect as i,useCallback as t,Fragment as r,createElement as l}from"react";import{defaultMargin as u,getRelativeCursor as a,getDistance as d,Container as s,useDimensions as c,SvgWrapper as h,ResponsiveWrapper as v}from"@nivo/core";import{scaleLinear as f}from"d3-scale";import{Delaunay as p}from"d3-delaunay";import{useTooltip as g}from"@nivo/tooltip";import{jsx as m,jsxs as M,Fragment as b}from"react/jsx-runtime";function k(){return k=Object.assign?Object.assign.bind():function(n){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},k.apply(this,arguments)}var y={xDomain:[0,1],yDomain:[0,1],layers:["links","cells","points","bounds"],enableLinks:!1,linkLineWidth:1,linkLineColor:"#bbbbbb",enableCells:!0,cellLineWidth:2,cellLineColor:"#000000",enablePoints:!0,pointSize:4,pointColor:"#666666",role:"img"},C=function(n){return[n.x,n.y]},L=u,T="cursor",P="top",w=function(n){var o=n.points,e=n.getNodePosition,i=void 0===e?C:e,t=n.margin,r=void 0===t?L:t;return o.map((function(n){var o=i(n),e=o[0],t=o[1];return[e+r.left,t+r.top]}))},E=function(n){var o=n.points,e=n.width,i=n.height,t=n.margin,r=void 0===t?L:t,l=n.debug,u=p.from(o),a=l?u.voronoi([0,0,r.left+e+r.right,r.top+i+r.bottom]):void 0;return{points:o,delaunay:u,voronoi:a}},W=function(o){var e=o.points,i=o.getNodePosition,t=void 0===i?C:i,r=o.width,l=o.height,u=o.margin,a=void 0===u?L:u,d=o.debug;return n((function(){return E({points:w({points:e,margin:a,getNodePosition:t}),width:r,height:l,margin:a,debug:d})}),[e,r,l,a,d])},x=function(o){var e=o.data,i=o.width,t=o.height,r=o.xDomain,l=o.yDomain,u=n((function(){return f().domain(r).range([0,i])}),[r,i]),a=n((function(){return f().domain(l).range([0,t])}),[l,t]),d=n((function(){return e.map((function(n){return{x:u(n.x),y:a(n.y),data:n}}))}),[e,u,a]);return n((function(){var n=p.from(d.map((function(n){return[n.x,n.y]}))),o=n.voronoi([0,0,i,t]);return{points:d,delaunay:n,voronoi:o}}),[d,i,t])},S=function(o){var e=o.points,i=o.delaunay,t=o.voronoi;return n((function(){return{points:e,delaunay:i,voronoi:t}}),[e,i,t])},D=function(r){var l=r.elementRef,u=r.nodes,s=r.getNodePosition,c=void 0===s?C:s,h=r.delaunay,v=r.setCurrent,f=r.margin,p=void 0===f?L:f,m=r.detectionRadius,M=void 0===m?1/0:m,b=r.isInteractive,k=void 0===b||b,y=r.onMouseEnter,w=r.onMouseMove,E=r.onMouseLeave,W=r.onClick,x=r.onTouchStart,S=r.onTouchMove,D=r.onTouchEnd,R=r.enableTouchCrosshair,A=void 0!==R&&R,N=r.tooltip,O=r.tooltipPosition,j=void 0===O?T:O,I=r.tooltipAnchor,z=void 0===I?P:I,F=o(null),H=F[0],B=F[1],q=e(null);i((function(){q.current=H}),[q,H]);var G=t((function(n){if(!l.current)return null;var o=a(l.current,n),e=o[0],i=o[1],t=h.find(e,i),r=void 0!==t?u[t]:null;if(r&&M!==1/0){var s=c(r),v=s[0],f=s[1];d(e,i,v+p.left,f+p.top)>M&&(t=null,r=null)}return null===t||null===r?null:[t,r]}),[l,h,u,c,p,M]),J=g(),K=J.showTooltipAt,Q=J.showTooltipFromEvent,U=J.hideTooltip,V=n((function(){if(N)return"cursor"===j?function(n,o){Q(N(n),o,z)}:function(n){var o=c(n),e=o[0],i=o[1];K(N(n),[e+p.left,i+p.top],z)}}),[K,Q,N,j,z,c,p]),X=t((function(n){var o=G(n);if(B(o),null==v||v(o?o[1]:null),o){var e=o[1];null==V||V(e,n),null==y||y(o[1],n)}}),[G,B,v,V,y]),Y=t((function(n){var o=G(n);if(B(o),o){var e=o[0],i=o[1];if(null==v||v(i),null==V||V(i,n),q.current){var t=q.current,r=t[0],l=t[1];e!==r?null==E||E(l,n):null==w||w(i,n)}else null==y||y(i,n)}else null==v||v(null),null==U||U(),q.current&&(null==E||E(q.current[1],n))}),[G,B,q,y,w,E,V,U]),Z=t((function(n){B(null),null==v||v(null),U(),E&&q.current&&E(q.current[1],n)}),[B,v,q,U,E]),$=t((function(n){var o=G(n);B(o),o&&(null==W||W(o[1],n))}),[G,B,W]),_=t((function(n){var o=G(n);A&&(B(o),null==v||v(o?o[1]:null)),o&&(null==x||x(o[1],n))}),[G,B,v,A,x]),nn=t((function(n){var o=G(n);A&&(B(o),null==v||v(o?o[1]:null)),o&&(null==S||S(o[1],n))}),[G,B,v,A,S]),on=t((function(n){A&&(B(null),null==v||v(null)),D&&q.current&&D(q.current[1],n)}),[A,B,v,D,q]);return{current:H,handleMouseEnter:k?X:void 0,handleMouseMove:k?Y:void 0,handleMouseLeave:k?Z:void 0,handleClick:k?$:void 0,handleTouchStart:k?_:void 0,handleTouchMove:k?nn:void 0,handleTouchEnd:k?on:void 0}},R=function(n){var o=n.elementRef,e=n.nodes,i=n.getNodePosition,t=n.width,r=n.height,l=n.margin,u=void 0===l?L:l,a=n.isInteractive,d=void 0===a||a,s=n.detectionRadius,c=void 0===s?1/0:s,h=n.setCurrent,v=n.onMouseEnter,f=n.onMouseMove,p=n.onMouseLeave,g=n.onClick,m=n.tooltip,M=n.tooltipPosition,b=void 0===M?T:M,k=n.tooltipAnchor,y=void 0===k?P:k,C=n.debug,w=W({points:e,getNodePosition:i,width:t,height:r,margin:u,debug:void 0!==C&&C}),E=w.delaunay,x=w.voronoi,S=D({elementRef:o,nodes:e,margin:u,setCurrent:h,delaunay:E,detectionRadius:c,isInteractive:d,onMouseEnter:v,onMouseMove:f,onMouseLeave:p,onClick:g,tooltip:m,tooltipPosition:b,tooltipAnchor:y}),R=S.handleMouseEnter,A=S.handleMouseMove,N=S.handleMouseLeave,O=S.handleClick;return{delaunay:E,voronoi:x,current:S.current,handleMouseEnter:R,handleMouseMove:A,handleMouseLeave:N,handleClick:O}},A=["theme"],N=function(n){var o=n.data,e=n.width,i=n.height,t=n.margin,u=n.layers,a=void 0===u?y.layers:u,d=n.xDomain,s=void 0===d?y.xDomain:d,v=n.yDomain,f=void 0===v?y.yDomain:v,p=n.enableLinks,g=void 0===p?y.enableLinks:p,M=n.linkLineWidth,b=void 0===M?y.linkLineWidth:M,k=n.linkLineColor,C=void 0===k?y.linkLineColor:k,L=n.enableCells,T=void 0===L?y.enableCells:L,P=n.cellLineWidth,w=void 0===P?y.cellLineWidth:P,E=n.cellLineColor,W=void 0===E?y.cellLineColor:E,D=n.enablePoints,R=void 0===D?y.enableCells:D,A=n.pointSize,N=void 0===A?y.pointSize:A,O=n.pointColor,j=void 0===O?y.pointColor:O,I=n.role,z=void 0===I?y.role:I,F=c(e,i,t),H=F.outerWidth,B=F.outerHeight,q=F.margin,G=F.innerWidth,J=F.innerHeight,K=x({data:o,width:G,height:J,xDomain:s,yDomain:f}),Q=K.points,U=K.delaunay,V=K.voronoi,X={links:null,cells:null,points:null,bounds:null};g&&a.includes("links")&&(X.links=m("path",{stroke:C,strokeWidth:b,fill:"none",d:U.render()},"links")),T&&a.includes("cells")&&(X.cells=m("path",{d:V.render(),fill:"none",stroke:W,strokeWidth:w},"cells")),R&&a.includes("points")&&(X.points=m("path",{stroke:"none",fill:j,d:U.renderPoints(void 0,N/2)},"points")),a.includes("bounds")&&(X.bounds=m("path",{fill:"none",stroke:W,strokeWidth:w,d:V.renderBounds()},"bounds"));var Y=S({points:Q,delaunay:U,voronoi:V});return m(h,{width:H,height:B,margin:q,role:z,children:a.map((function(n,o){return void 0!==X[n]?X[n]:"function"==typeof n?m(r,{children:l(n,Y)},o):null}))})},O=function(n){var o=n.theme,e=function(n,o){if(null==n)return{};var e,i,t={},r=Object.keys(n);for(i=0;i<r.length;i++)e=r[i],o.indexOf(e)>=0||(t[e]=n[e]);return t}(n,A);return m(s,{isInteractive:!1,animate:!1,theme:o,children:m(N,k({},e))})},j=function(n){return m(v,{children:function(o){var e=o.width,i=o.height;return m(O,k({width:e,height:i},n))}})},I=function(o){var i=o.nodes,t=o.width,r=o.height,l=o.margin,u=void 0===l?L:l,a=o.getNodePosition,d=o.setCurrent,s=o.onMouseEnter,c=o.onMouseMove,h=o.onMouseLeave,v=o.onClick,f=o.onTouchStart,p=o.onTouchMove,g=o.onTouchEnd,k=o.enableTouchCrosshair,y=void 0!==k&&k,C=o.detectionRadius,w=void 0===C?1/0:C,E=o.tooltip,x=o.tooltipPosition,S=void 0===x?T:x,R=o.tooltipAnchor,A=void 0===R?P:R,N=o.debug,O=e(null),j=W({points:i,getNodePosition:a,width:t,height:r,margin:u,debug:N}),I=j.delaunay,z=j.voronoi,F=D({elementRef:O,nodes:i,delaunay:I,margin:u,detectionRadius:w,setCurrent:d,onMouseEnter:s,onMouseMove:c,onMouseLeave:h,onClick:v,onTouchStart:f,onTouchMove:p,onTouchEnd:g,enableTouchCrosshair:y,tooltip:E,tooltipPosition:S,tooltipAnchor:A}),H=F.current,B=F.handleMouseEnter,q=F.handleMouseMove,G=F.handleMouseLeave,J=F.handleClick,K=F.handleTouchStart,Q=F.handleTouchMove,U=F.handleTouchEnd,V=n((function(){if(N&&z)return z.render()}),[N,z]);return M("g",{ref:O,transform:"translate("+-u.left+","+-u.top+")",children:[N&&z&&M(b,{children:[m("path",{d:V,stroke:"red",strokeWidth:1,opacity:.75}),w<1/0&&m("path",{stroke:"red",strokeWidth:.35,fill:"none",d:I.renderPoints(void 0,w)}),H&&m("path",{fill:"pink",opacity:.35,d:z.renderCell(H[0])})]}),m("rect",{"data-ref":"mesh-interceptor",width:u.left+t+u.right,height:u.top+r+u.bottom,fill:"red",opacity:0,style:{cursor:"auto"},onMouseEnter:B,onMouseMove:q,onMouseLeave:G,onTouchStart:K,onTouchMove:Q,onTouchEnd:U,onClick:J})]})},z=function(n,o){n.save(),n.globalAlpha=.75,n.beginPath(),o.render(n),n.strokeStyle="red",n.lineWidth=1,n.stroke(),n.restore()},F=function(n,o,e){n.save(),n.globalAlpha=.15,n.beginPath(),o.renderPoints(n,e),n.strokeStyle="red",n.lineWidth=1,n.stroke(),n.restore()},H=function(n,o,e){n.save(),n.globalAlpha=.35,n.beginPath(),o.renderCell(e,n),n.fillStyle="pink",n.fill(),n.restore()},B=function(n,o){var e=o.delaunay,i=o.voronoi,t=o.detectionRadius,r=o.index;z(n,i),t<1/0&&F(n,e,t),null!==r&&H(n,i,r)};export{I as Mesh,j as ResponsiveVoronoi,O as Voronoi,E as computeMesh,w as computeMeshPoints,y as defaultVoronoiProps,B as renderDebugToCanvas,F as renderDelaunayPointsToCanvas,H as renderVoronoiCellToCanvas,z as renderVoronoiToCanvas,R as useMesh,D as useMeshEvents,x as useVoronoi,S as useVoronoiLayerContext,W as useVoronoiMesh};
//# sourceMappingURL=nivo-voronoi.es.js.map
