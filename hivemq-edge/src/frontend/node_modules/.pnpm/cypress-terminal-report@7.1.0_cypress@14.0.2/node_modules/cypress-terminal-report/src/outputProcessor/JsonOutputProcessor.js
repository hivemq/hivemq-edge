"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const BaseOutputProcessor_1 = __importDefault(require("./BaseOutputProcessor"));
class JsonOutputProcessor extends BaseOutputProcessor_1.default {
    constructor() {
        super(...arguments);
        this.chunkSeparator = ',\n';
        this.initialContent = '{\n\n}';
    }
    write(allMessages) {
        Object.entries(allMessages).forEach(([spec, tests]) => {
            let data = { [spec]: {} };
            Object.entries(tests).forEach(([test, messages]) => {
                data[spec][test] = messages.map((message) => {
                    const { timeString, ...data } = message;
                    if (timeString) {
                        data.timeString = timeString;
                    }
                    return data;
                });
            });
            let chunk = JSON.stringify(data, null, 2);
            chunk = chunk.slice(2, -2);
            this.writeSpecChunk(spec, chunk, -2);
        });
    }
}
exports.default = JsonOutputProcessor;
