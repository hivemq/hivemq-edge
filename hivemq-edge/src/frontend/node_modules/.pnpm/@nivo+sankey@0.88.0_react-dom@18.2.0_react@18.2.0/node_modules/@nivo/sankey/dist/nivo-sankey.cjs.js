"use strict";var e=require("react"),o=require("lodash/uniq"),n=require("@nivo/core"),t=require("@nivo/legends"),i=require("d3-sankey"),r=require("@nivo/tooltip"),a=require("react/jsx-runtime"),l=require("lodash/cloneDeep"),d=require("@nivo/colors"),s=require("@react-spring/web"),c=require("d3-shape");function u(){return u=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},u.apply(this,arguments)}var h={container:{display:"flex",alignItems:"center"},sourceChip:{marginRight:7},targetChip:{marginLeft:7,marginRight:7}},p={center:i.sankeyCenter,justify:i.sankeyJustify,start:i.sankeyLeft,end:i.sankeyRight},v=Object.keys(p),g=function(e){return p[e]},y={layout:"horizontal",align:"center",sort:"auto",colors:{scheme:"nivo"},nodeOpacity:.75,nodeHoverOpacity:1,nodeHoverOthersOpacity:.15,nodeThickness:12,nodeSpacing:12,nodeInnerPadding:0,nodeBorderWidth:1,nodeBorderColor:{from:"color",modifiers:[["darker",.5]]},nodeBorderRadius:0,linkOpacity:.25,linkHoverOpacity:.6,linkHoverOthersOpacity:.15,linkContract:0,linkBlendMode:"multiply",enableLinkGradient:!1,enableLabels:!0,label:"id",labelPosition:"inside",labelPadding:9,labelOrientation:"horizontal",labelTextColor:{from:"color",modifiers:[["darker",.8]]},isInteractive:!0,nodeTooltip:function(e){var o=e.node;return a.jsx(r.BasicTooltip,{id:o.label,enableChip:!0,color:o.color})},linkTooltip:function(e){var o=e.link;return a.jsx(r.BasicTooltip,{id:a.jsxs("span",{style:h.container,children:[a.jsx(r.Chip,{color:o.source.color,style:h.sourceChip}),a.jsx("strong",{children:o.source.label})," > ",a.jsx("strong",{children:o.target.label}),a.jsx(r.Chip,{color:o.target.color,style:h.targetChip}),a.jsx("strong",{children:o.formattedValue})]})})},legends:[],layers:["links","nodes","labels","legends"],role:"img",animate:!0,motionConfig:"gentle"},f=function(e){return e.id},k=function(o){var t=o.data,r=o.valueFormat,a=o.layout,s=o.width,c=o.height,u=o.sort,h=o.align,p=o.colors,v=o.nodeThickness,y=o.nodeSpacing,k=o.nodeInnerPadding,x=o.nodeBorderColor,m=o.label,b=o.labelTextColor,C=e.useState(null),O=C[0],j=C[1],M=e.useState(null),L=M[0],T=M[1],B=e.useMemo((function(){if("auto"!==u)return"input"===u?null:"ascending"===u?function(e,o){return e.value-o.value}:"descending"===u?function(e,o){return o.value-e.value}:u}),[u]),I="input"===u?null:void 0,w=e.useMemo((function(){return"function"==typeof h?h:g(h)}),[h]),P=n.useTheme(),H=d.useOrdinalColorScale(p,"id"),S=d.useInheritedColor(x,P),W=n.usePropertyAccessor(m),F=d.useInheritedColor(b,P),N=n.useValueFormatter(r),E=e.useMemo((function(){return function(e){var o=e.data,n=e.formatValue,t=e.layout,r=e.alignFunction,a=e.sortFunction,d=e.linkSortMode,s=e.nodeThickness,c=e.nodeSpacing,u=e.nodeInnerPadding,h=e.width,p=e.height,v=e.getColor,g=e.getLabel,y=i.sankey().nodeAlign(r).nodeSort(a).linkSort(d).nodeWidth(s).nodePadding(c).size("horizontal"===t?[h,p]:[p,h]).nodeId(f),k=l(o);return y(k),k.nodes.forEach((function(e){if(e.color=v(e),e.label=g(e),e.formattedValue=n(e.value),"horizontal"===t)e.x=e.x0+u,e.y=e.y0,e.width=Math.max(e.x1-e.x0-2*u,0),e.height=Math.max(e.y1-e.y0,0);else{e.x=e.y0,e.y=e.x0+u,e.width=Math.max(e.y1-e.y0,0),e.height=Math.max(e.x1-e.x0-2*u,0);var o=e.x0,i=e.x1;e.x0=e.y0,e.x1=e.y1,e.y0=o,e.y1=i}})),k.links.forEach((function(e){e.formattedValue=n(e.value),e.color=e.source.color,e.pos0=e.y0,e.pos1=e.y1,e.thickness=e.width,delete e.y0,delete e.y1,delete e.width})),k}({data:t,formatValue:N,layout:a,alignFunction:w,sortFunction:B,linkSortMode:I,nodeThickness:v,nodeSpacing:y,nodeInnerPadding:k,width:s,height:c,getColor:H,getLabel:W})}),[t,N,a,w,B,I,v,y,k,s,c,H,W]),R=E.nodes,q=E.links,A=e.useMemo((function(){return R.map((function(e){return{id:e.id,label:e.label,color:e.color}}))}),[R]);return{nodes:R,links:q,legendData:A,getNodeBorderColor:S,currentNode:O,setCurrentNode:j,currentLink:L,setCurrentLink:T,getLabelTextColor:F}},x=function(o){var t=o.node,i=o.x,l=o.y,d=o.width,c=o.height,u=o.color,h=o.opacity,p=o.borderWidth,v=o.borderColor,g=o.borderRadius,y=o.setCurrent,f=o.isInteractive,k=o.onClick,x=o.tooltip,m=n.useMotionConfig(),b=m.animate,C=m.config,O=s.useSpring({x:i,y:l,width:d,height:c,opacity:h,color:u,config:C,immediate:!b}),j=r.useTooltip(),M=j.showTooltipFromEvent,L=j.hideTooltip,T=e.useCallback((function(o){y(t),M(e.createElement(x,{node:t}),o,"left")}),[y,t,M,x]),B=e.useCallback((function(o){M(e.createElement(x,{node:t}),o,"left")}),[M,t,x]),I=e.useCallback((function(){y(null),L()}),[y,L]),w=e.useCallback((function(e){null==k||k(t,e)}),[k,t]);return a.jsx(s.animated.rect,{x:O.x,y:O.y,rx:g,ry:g,width:O.width.to((function(e){return Math.max(e,0)})),height:O.height.to((function(e){return Math.max(e,0)})),fill:O.color,fillOpacity:O.opacity,strokeWidth:p,stroke:v,strokeOpacity:h,onMouseEnter:f?T:void 0,onMouseMove:f?B:void 0,onMouseLeave:f?I:void 0,onClick:f?w:void 0})},m=function(e){var o=e.nodes,n=e.nodeOpacity,t=e.nodeHoverOpacity,i=e.nodeHoverOthersOpacity,r=e.borderWidth,l=e.getBorderColor,d=e.borderRadius,s=e.setCurrentNode,c=e.currentNode,u=e.currentLink,h=e.isCurrentNode,p=e.isInteractive,v=e.onClick,g=e.tooltip,y=function(e){return c||u?h(e)?t:i:n};return a.jsx(a.Fragment,{children:o.map((function(e){return a.jsx(x,{node:e,x:e.x,y:e.y,width:e.width,height:e.height,color:e.color,opacity:y(e),borderWidth:r,borderColor:l(e),borderRadius:d,setCurrent:s,isInteractive:p,onClick:v,tooltip:g},e.id)}))})},b=function(e){var o,n=e.id,t=e.layout,i=e.startColor,r=e.endColor;return o="horizontal"===t?{x1:"0%",x2:"100%",y1:"0%",y2:"0%"}:{x1:"0%",x2:"0%",y1:"0%",y2:"100%"},a.jsxs("linearGradient",u({id:n,spreadMethod:"pad"},o,{children:[a.jsx("stop",{offset:"0%",stopColor:i}),a.jsx("stop",{offset:"100%",stopColor:r})]}))},C=function(o){var t=o.link,i=o.layout,l=o.path,d=o.color,c=o.opacity,u=o.blendMode,h=o.enableGradient,p=o.setCurrent,v=o.tooltip,g=o.isInteractive,y=o.onClick,f=t.source.id+"."+t.target.id+"."+t.index,k=n.useMotionConfig(),x=k.animate,m=k.config,C=n.useAnimatedPath(l),O=s.useSpring({color:d,opacity:c,config:m,immediate:!x}),j=r.useTooltip(),M=j.showTooltipFromEvent,L=j.hideTooltip,T=e.useCallback((function(o){p(t),M(e.createElement(v,{link:t}),o,"left")}),[p,t,M,v]),B=e.useCallback((function(o){M(e.createElement(v,{link:t}),o,"left")}),[M,t,v]),I=e.useCallback((function(){p(null),L()}),[p,L]),w=e.useCallback((function(e){null==y||y(t,e)}),[y,t]);return a.jsxs(a.Fragment,{children:[h&&a.jsx(b,{id:f,layout:i,startColor:t.startColor||t.source.color,endColor:t.endColor||t.target.color}),a.jsx(s.animated.path,{fill:h?'url("#'+encodeURI(f)+'")':O.color,d:C,fillOpacity:O.opacity,onMouseEnter:g?T:void 0,onMouseMove:g?B:void 0,onMouseLeave:g?I:void 0,onClick:g?w:void 0,style:{mixBlendMode:u}})]})},O=function(o){var n=o.links,t=o.layout,i=o.linkOpacity,r=o.linkHoverOpacity,l=o.linkHoverOthersOpacity,d=o.linkContract,s=o.linkBlendMode,u=o.enableLinkGradient,h=o.setCurrentLink,p=o.currentLink,v=o.currentNode,g=o.isCurrentLink,y=o.isInteractive,f=o.onClick,k=o.tooltip,x=function(e){return v||p?g(e)?r:l:i},m=e.useMemo((function(){return"horizontal"===t?(e=c.line().curve(c.curveMonotoneX),function(o,n){var t=Math.max(1,o.thickness-2*n)/2,i=.12*(o.target.x0-o.source.x1),r=[[o.source.x1,o.pos0-t],[o.source.x1+i,o.pos0-t],[o.target.x0-i,o.pos1-t],[o.target.x0,o.pos1-t],[o.target.x0,o.pos1+t],[o.target.x0-i,o.pos1+t],[o.source.x1+i,o.pos0+t],[o.source.x1,o.pos0+t],[o.source.x1,o.pos0-t]];return e(r)+"Z"}):function(){var e=c.line().curve(c.curveMonotoneY);return function(o,n){var t=Math.max(1,o.thickness-2*n)/2,i=.12*(o.target.y0-o.source.y1),r=[[o.pos0+t,o.source.y1],[o.pos0+t,o.source.y1+i],[o.pos1+t,o.target.y0-i],[o.pos1+t,o.target.y0],[o.pos1-t,o.target.y0],[o.pos1-t,o.target.y0-i],[o.pos0-t,o.source.y1+i],[o.pos0-t,o.source.y1],[o.pos0+t,o.source.y1]];return e(r)+"Z"}}();var e}),[t]);return a.jsx(a.Fragment,{children:n.map((function(e){return a.jsx(C,{link:e,layout:t,path:m(e,d),color:e.color,opacity:x(e),blendMode:s,enableGradient:u,setCurrent:h,isInteractive:y,onClick:f,tooltip:k},e.source.id+"."+e.target.id+"."+e.index)}))})},j=function(e){var o=e.nodes,t=e.layout,i=e.width,r=e.height,l=e.labelPosition,d=e.labelPadding,c=e.labelOrientation,h=e.getLabelTextColor,p=n.useTheme(),v="vertical"===c?-90:0,g=o.map((function(e){var o,n,a;return"horizontal"===t?(n=e.y+e.height/2,e.x<i/2?"inside"===l?(o=e.x1+d,a="vertical"===c?"middle":"start"):(o=e.x-d,a="vertical"===c?"middle":"end"):"inside"===l?(o=e.x-d,a="vertical"===c?"middle":"end"):(o=e.x1+d,a="vertical"===c?"middle":"start")):"vertical"===t&&(o=e.x+e.width/2,e.y<r/2?"inside"===l?(n=e.y1+d,a="vertical"===c?"end":"middle"):(n=e.y-d,a="vertical"===c?"start":"middle"):"inside"===l?(n=e.y-d,a="vertical"===c?"start":"middle"):(n=e.y1+d,a="vertical"===c?"end":"middle")),{id:e.id,label:e.label,x:o,y:n,textAnchor:a,color:h(e)}})),y=n.useMotionConfig(),f=y.animate,k=y.config,x=s.useSprings(g.length,g.map((function(e){return{transform:"translate("+e.x+", "+e.y+") rotate("+v+")",color:e.color,config:k,immediate:!f}})));return a.jsx(a.Fragment,{children:x.map((function(e,o){var n=g[o];return a.jsx(s.animated.text,{dominantBaseline:"central",textAnchor:n.textAnchor,transform:e.transform,style:u({},p.labels.text,{fill:e.color,pointerEvents:"none"}),children:n.label},n.id)}))})},M=["isInteractive","animate","motionConfig","theme","renderWrapper"],L=function(i){var r=i.data,l=i.valueFormat,d=i.layout,s=void 0===d?y.layout:d,c=i.sort,h=void 0===c?y.sort:c,p=i.align,v=void 0===p?y.align:p,g=i.width,f=i.height,x=i.margin,b=i.colors,C=void 0===b?y.colors:b,M=i.nodeThickness,L=void 0===M?y.nodeThickness:M,T=i.nodeSpacing,B=void 0===T?y.nodeThickness:T,I=i.nodeInnerPadding,w=void 0===I?y.nodeInnerPadding:I,P=i.nodeBorderColor,H=void 0===P?y.nodeBorderColor:P,S=i.nodeOpacity,W=void 0===S?y.nodeOpacity:S,F=i.nodeHoverOpacity,N=void 0===F?y.nodeHoverOpacity:F,E=i.nodeHoverOthersOpacity,R=void 0===E?y.nodeHoverOthersOpacity:E,q=i.nodeBorderWidth,A=void 0===q?y.nodeBorderWidth:q,z=i.nodeBorderRadius,G=void 0===z?y.nodeBorderRadius:z,D=i.linkOpacity,V=void 0===D?y.linkOpacity:D,Z=i.linkHoverOpacity,J=void 0===Z?y.linkHoverOpacity:Z,K=i.linkHoverOthersOpacity,U=void 0===K?y.linkHoverOthersOpacity:K,X=i.linkContract,Y=void 0===X?y.linkContract:X,Q=i.linkBlendMode,$=void 0===Q?y.linkBlendMode:Q,_=i.enableLinkGradient,ee=void 0===_?y.enableLinkGradient:_,oe=i.enableLabels,ne=void 0===oe?y.enableLabels:oe,te=i.labelPosition,ie=void 0===te?y.labelPosition:te,re=i.labelPadding,ae=void 0===re?y.labelPadding:re,le=i.labelOrientation,de=void 0===le?y.labelOrientation:le,se=i.label,ce=void 0===se?y.label:se,ue=i.labelTextColor,he=void 0===ue?y.labelTextColor:ue,pe=i.nodeTooltip,ve=void 0===pe?y.nodeTooltip:pe,ge=i.linkTooltip,ye=void 0===ge?y.linkTooltip:ge,fe=i.isInteractive,ke=void 0===fe?y.isInteractive:fe,xe=i.onClick,me=i.legends,be=void 0===me?y.legends:me,Ce=i.layers,Oe=void 0===Ce?y.layers:Ce,je=i.role,Me=void 0===je?y.role:je,Le=i.ariaLabel,Te=i.ariaLabelledBy,Be=i.ariaDescribedBy,Ie=n.useDimensions(g,f,x),we=Ie.margin,Pe=Ie.innerWidth,He=Ie.innerHeight,Se=Ie.outerWidth,We=Ie.outerHeight,Fe=k({data:r,valueFormat:l,layout:s,width:Pe,height:He,sort:h,align:v,colors:C,nodeThickness:L,nodeSpacing:B,nodeInnerPadding:w,nodeBorderColor:H,label:ce,labelTextColor:he}),Ne=Fe.nodes,Ee=Fe.links,Re=Fe.legendData,qe=Fe.getNodeBorderColor,Ae=Fe.currentNode,ze=Fe.setCurrentNode,Ge=Fe.currentLink,De=Fe.setCurrentLink,Ve=Fe.getLabelTextColor,Ze=function(){return!1},Je=function(){return!1};if(Ge&&(Ze=function(e){var o=e.id;return o===Ge.source.id||o===Ge.target.id},Je=function(e){var o=e.source,n=e.target;return o.id===Ge.source.id&&n.id===Ge.target.id}),Ae){var Ke=[Ae.id];Ee.filter((function(e){var o=e.source,n=e.target;return o.id===Ae.id||n.id===Ae.id})).forEach((function(e){var o=e.source,n=e.target;Ke.push(o.id),Ke.push(n.id)})),Ke=o(Ke),Ze=function(e){var o=e.id;return Ke.includes(o)},Je=function(e){var o=e.source,n=e.target;return o.id===Ae.id||n.id===Ae.id}}var Ue={links:Ee,nodes:Ne,margin:we,width:g,height:f,outerWidth:Se,outerHeight:We},Xe={links:null,nodes:null,labels:null,legends:null};return Oe.includes("links")&&(Xe.links=a.jsx(O,{links:Ee,layout:s,linkContract:Y,linkOpacity:V,linkHoverOpacity:J,linkHoverOthersOpacity:U,linkBlendMode:$,enableLinkGradient:ee,setCurrentLink:De,currentNode:Ae,currentLink:Ge,isCurrentLink:Je,isInteractive:ke,onClick:xe,tooltip:ye},"links")),Oe.includes("nodes")&&(Xe.nodes=a.jsx(m,{nodes:Ne,nodeOpacity:W,nodeHoverOpacity:N,nodeHoverOthersOpacity:R,borderWidth:A,borderRadius:G,getBorderColor:qe,setCurrentNode:ze,currentNode:Ae,currentLink:Ge,isCurrentNode:Ze,isInteractive:ke,onClick:xe,tooltip:ve},"nodes")),Oe.includes("labels")&&ne&&(Xe.labels=a.jsx(j,{nodes:Ne,layout:s,width:Pe,height:He,labelPosition:ie,labelPadding:ae,labelOrientation:de,getLabelTextColor:Ve},"labels")),Oe.includes("legends")&&(Xe.legends=a.jsx(e.Fragment,{children:be.map((function(e,o){return a.jsx(t.BoxLegendSvg,u({},e,{containerWidth:Pe,containerHeight:He,data:Re}),"legend"+o)}))},"legends")),a.jsx(n.SvgWrapper,{width:Se,height:We,margin:we,role:Me,ariaLabel:Le,ariaLabelledBy:Te,ariaDescribedBy:Be,children:Oe.map((function(o,n){var t;return"function"==typeof o?a.jsx(e.Fragment,{children:e.createElement(o,Ue)},n):null!=(t=null==Xe?void 0:Xe[o])?t:null}))})},T=function(e){var o=e.isInteractive,t=void 0===o?y.isInteractive:o,i=e.animate,r=void 0===i?y.animate:i,l=e.motionConfig,d=void 0===l?y.motionConfig:l,s=e.theme,c=e.renderWrapper,h=function(e,o){if(null==e)return{};var n,t,i={},r=Object.keys(e);for(t=0;t<r.length;t++)n=r[t],o.indexOf(n)>=0||(i[n]=e[n]);return i}(e,M);return a.jsx(n.Container,{animate:r,isInteractive:t,motionConfig:d,renderWrapper:c,theme:s,children:a.jsx(L,u({isInteractive:t},h))})};exports.ResponsiveSankey=function(e){return a.jsx(n.ResponsiveWrapper,{children:function(o){var n=o.width,t=o.height;return a.jsx(T,u({width:n,height:t},e))}})},exports.Sankey=T,exports.sankeyAlignmentFromProp=g,exports.sankeyAlignmentPropKeys=v,exports.sankeyAlignmentPropMapping=p,exports.svgDefaultProps=y;
//# sourceMappingURL=nivo-sankey.cjs.js.map
